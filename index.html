<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#2ecc71">
<title>NutriScan AI</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root{--p:#2ecc71;--pd:#27ae60;--pl:#a8e6c1;--bg:#f4fff7;--card:#fff;--txt:#1a2e1a;--muted:#6b7c6b;--sh:0 4px 20px rgba(46,204,113,.12);--r:16px;--nav:70px;font-family:'Inter',sans-serif}
[data-dark]{--bg:#0d1f0d;--card:#1a2e1a;--txt:#e8f5e9;--muted:#81c784;--sh:0 4px 20px rgba(0,0,0,.4)}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--txt);min-height:100vh;overflow-x:hidden;transition:.3s;-webkit-tap-highlight-color:transparent}
h1,h2,h3,h4{font-family:'Poppins',sans-serif}
button{cursor:pointer;border:none;outline:none;background:none}
input{outline:none;border:none;font-family:inherit}

/* SPLASH */
#splash{position:fixed;inset:0;z-index:9999;background:linear-gradient(145deg,#27ae60,#2ecc71,#52d98a);display:flex;flex-direction:column;align-items:center;justify-content:center;transition:opacity .6s,transform .6s}
#splash.hide{opacity:0;transform:scale(1.05);pointer-events:none}
.sp-logo{width:110px;height:110px;background:rgba(255,255,255,.2);border-radius:30px;display:flex;align-items:center;justify-content:center;margin-bottom:20px;animation:pulse 1.5s infinite}
.sp-logo i{font-size:52px;color:#fff}
#splash h1{color:#fff;font-size:28px;font-weight:800}
#splash p{color:rgba(255,255,255,.85);font-size:13px;margin-top:6px}
.sp-bar{margin-top:40px;width:50px;height:4px;background:rgba(255,255,255,.3);border-radius:10px;overflow:hidden}
.sp-fill{height:100%;background:#fff;border-radius:10px;animation:fill 2.2s ease forwards}
@keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(255,255,255,.4)}50%{box-shadow:0 0 0 20px rgba(255,255,255,0)}}
@keyframes fill{from{width:0}to{width:100%}}

/* MUSIC CONTROL */
.music-fab{position:fixed;bottom:calc(var(--nav) + 14px);right:14px;width:44px;height:44px;background:linear-gradient(135deg,var(--p),var(--pd));border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-size:17px;z-index:200;box-shadow:0 4px 16px rgba(46,204,113,.5);transition:.3s;border:none;cursor:pointer}
.music-fab.muted{background:rgba(107,124,107,.5);box-shadow:none}
.music-fab .eq{display:flex;gap:2px;align-items:flex-end}
.music-fab .eq span{width:3px;background:#fff;border-radius:2px;animation:eq 0.6s ease-in-out infinite alternate}
.music-fab .eq span:nth-child(1){height:8px;animation-delay:0s}
.music-fab .eq span:nth-child(2){height:14px;animation-delay:.15s}
.music-fab .eq span:nth-child(3){height:6px;animation-delay:.3s}
.music-fab .eq span:nth-child(4){height:12px;animation-delay:.1s}
.music-fab.muted .eq span{animation:none;height:4px;opacity:.5}
@keyframes eq{from{transform:scaleY(.4)}to{transform:scaleY(1)}}

/* APP */
#app{display:none;flex-direction:column;min-height:100vh}
#app.on{display:flex}
@keyframes fi{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

/* HEADER */
.hdr{position:sticky;top:0;z-index:100;height:60px;background:var(--card);border-bottom:1px solid rgba(46,204,113,.15);display:flex;align-items:center;justify-content:space-between;padding:0 16px;box-shadow:0 2px 12px rgba(46,204,113,.08)}
.hl{display:flex;align-items:center;gap:10px}
.hl-ico{width:36px;height:36px;background:linear-gradient(135deg,var(--p),var(--pd));border-radius:10px;display:flex;align-items:center;justify-content:center}
.hl-ico i{color:#fff;font-size:16px}
.hl span{font-weight:700;font-size:17px;color:var(--txt)}
.ha{display:flex;align-items:center;gap:8px}
.ic-btn{width:36px;height:36px;border-radius:50%;background:var(--bg);display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:15px;transition:.3s}
.ic-btn:hover,.ic-btn.on{background:var(--p);color:#fff}
.lg-btn{padding:5px 12px;border-radius:20px;background:var(--bg);font-size:12px;font-weight:600;color:var(--pd);letter-spacing:.5px;transition:.3s;display:flex;align-items:center;gap:5px}
.lg-btn:hover{background:var(--p);color:#fff}

/* SCREENS */
.sc{display:none;flex:1;padding:16px 16px calc(var(--nav) + 16px);animation:fi .3s ease}
.sc.on{display:block}

/* BOTTOM NAV */
.bnav{position:fixed;bottom:0;left:0;right:0;height:var(--nav);background:var(--card);border-top:1px solid rgba(46,204,113,.15);display:flex;align-items:center;z-index:100;box-shadow:0 -4px 20px rgba(46,204,113,.1)}
.ni{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;padding:8px 4px;color:var(--muted);font-size:10px;font-weight:500;transition:.3s;position:relative}
.ni i{font-size:20px;transition:.3s}
.ni.on{color:var(--p)}
.ni.on i{transform:translateY(-2px)}
.ni.on::after{content:'';position:absolute;bottom:0;width:30px;height:3px;background:var(--p);border-radius:10px 10px 0 0}
.nsb{width:52px;height:52px;background:linear-gradient(135deg,var(--p),var(--pd));border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-size:22px;box-shadow:0 4px 15px rgba(46,204,113,.4);margin-top:-8px;transition:.3s}
.nsb:hover{transform:scale(1.08)}

/* RIPPLE */
.ripple{position:relative;overflow:hidden}
.ripple::after{content:'';position:absolute;border-radius:50%;background:rgba(255,255,255,.35);transform:scale(0);animation:ripAnim .5s linear;pointer-events:none}
@keyframes ripAnim{to{transform:scale(4);opacity:0}}

/* CARDS */
.card{background:var(--card);border-radius:var(--r);box-shadow:var(--sh);padding:16px;margin-bottom:14px}
.stitle{font-size:16px;font-weight:700;color:var(--txt);margin-bottom:14px;display:flex;align-items:center;gap:8px}
.stitle i{color:var(--p)}

/* HOME HERO */
.hero{background:linear-gradient(135deg,#27ae60,#2ecc71,#52d98a);border-radius:20px;padding:24px 20px;margin-bottom:16px;position:relative;overflow:hidden}
.hero::before{content:'';position:absolute;width:150px;height:150px;border-radius:50%;background:rgba(255,255,255,.08);top:-40px;right:-30px}
.hero::after{content:'';position:absolute;width:100px;height:100px;border-radius:50%;background:rgba(255,255,255,.06);bottom:-30px;left:30px}
.hero h2{color:#fff;font-size:20px;font-weight:800;line-height:1.3}
.hero p{color:rgba(255,255,255,.85);font-size:13px;margin-top:6px}
.hero-acts{display:flex;gap:10px;margin-top:18px;flex-wrap:wrap}
.hbtn{display:flex;align-items:center;gap:8px;padding:11px 18px;border-radius:50px;font-size:13px;font-weight:600;transition:.3s;position:relative;z-index:1}
.hbtn1{background:#fff;color:var(--pd)}
.hbtn2{background:rgba(255,255,255,.2);color:#fff;border:1px solid rgba(255,255,255,.3)}
.hbtn:active{transform:scale(.96)}

/* QUICK GRID */
.qg{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px}
.qc{background:var(--card);border-radius:var(--r);padding:18px 14px;box-shadow:var(--sh);display:flex;flex-direction:column;align-items:flex-start;gap:10px;transition:.3s;cursor:pointer}
.qc:active{transform:scale(.97)}
.qi{width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px}
.qc span{font-weight:600;font-size:13px;color:var(--txt)}
.qg1{background:rgba(46,204,113,.15);color:var(--pd)}
.qg2{background:rgba(52,152,219,.15);color:#2980b9}
.qg3{background:rgba(230,126,34,.15);color:#d35400}
.qg4{background:rgba(155,89,182,.15);color:#8e44ad}

/* SCAN */
.szn{border:2px dashed var(--pl);border-radius:20px;padding:30px 20px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;background:rgba(46,204,113,.04);min-height:200px;cursor:pointer;transition:.3s;text-align:center}
.szn:hover{border-color:var(--p);background:rgba(46,204,113,.08)}
.szn .scan-icon-wrap{width:80px;height:80px;background:linear-gradient(135deg,rgba(46,204,113,.2),rgba(39,174,96,.3));border-radius:50%;display:flex;align-items:center;justify-content:center;animation:scanPulse 2s ease-in-out infinite}
.szn .scan-icon-wrap i{font-size:36px;color:var(--p)}
@keyframes scanPulse{0%,100%{transform:scale(1);box-shadow:0 0 0 0 rgba(46,204,113,.3)}50%{transform:scale(1.05);box-shadow:0 0 0 15px rgba(46,204,113,0)}}
.szn h3{font-size:16px;font-weight:600}
.szn p{font-size:12px;color:var(--muted)}
.sbtns{display:flex;gap:10px;margin-top:4px}
.sbtn{flex:1;padding:14px;border-radius:var(--r);font-size:13px;font-weight:600;display:flex;align-items:center;justify-content:center;gap:8px;transition:.3s}
.sb1{background:linear-gradient(135deg,var(--p),var(--pd));color:#fff;box-shadow:0 4px 15px rgba(46,204,113,.35)}
.sb2{background:var(--card);color:var(--pd);box-shadow:var(--sh);border:1px solid rgba(46,204,113,.2)}
.sbtn:active{transform:scale(.97)}
#ipw{display:none;margin:14px 0}
#ipw img{width:100%;max-height:220px;object-fit:cover;border-radius:var(--r)}
.lov{display:none;flex-direction:column;align-items:center;justify-content:center;gap:16px;padding:30px}
.lov.on{display:flex}
.spin{width:50px;height:50px;border:4px solid var(--pl);border-top-color:var(--p);border-radius:50%;animation:sp .8s linear infinite}
@keyframes sp{to{transform:rotate(360deg)}}
.lov p{color:var(--muted);font-size:13px}

/* DEMO FOOD CHIPS */
.demo-chip{display:inline-flex;align-items:center;gap:6px;padding:7px 13px;background:rgba(46,204,113,.1);border-radius:50px;font-size:12px;font-weight:500;color:var(--pd);transition:.2s;cursor:pointer}
.demo-chip:hover{background:var(--p);color:#fff}
.demo-chip:active{transform:scale(.95)}

/* RESULT */
.rfh{display:flex;align-items:center;gap:14px;margin-bottom:16px}
.rfip{width:70px;height:70px;border-radius:14px;background:linear-gradient(135deg,var(--pl),var(--p));display:flex;align-items:center;justify-content:center;font-size:28px;flex-shrink:0}
.rfn{font-size:20px;font-weight:800}
.rfs{font-size:12px;color:var(--muted);margin-top:2px}
.disc{background:rgba(230,126,34,.12);color:#d35400;border-radius:20px;padding:5px 12px;font-size:11px;font-weight:500;margin-bottom:14px;display:inline-flex;align-items:center;gap:5px}
.mg{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.mi{background:var(--bg);border-radius:10px;padding:14px 12px;text-align:center}
.mv{font-size:22px;font-weight:800;font-family:'Poppins',sans-serif}
.ml{font-size:11px;color:var(--muted);margin-top:2px;display:flex;align-items:center;justify-content:center;gap:4px}
.mc{grid-column:span 2;background:linear-gradient(135deg,var(--p),var(--pd))}
.mc .mv,.mc .ml{color:#fff}
.mp .mv{color:#e74c3c}
.mca .mv{color:#f39c12}
.mf .mv{color:#9b59b6}
.nb{margin-bottom:12px}
.nbl{display:flex;justify-content:space-between;font-size:12px;margin-bottom:4px;align-items:center}
.nbl-left{display:flex;align-items:center;gap:6px}
.bt{height:8px;background:var(--bg);border-radius:10px;overflow:hidden}
.bf{height:100%;border-radius:10px;transition:width .8s ease}
.bg_{display:grid;gap:10px}
.bi{display:flex;align-items:center;gap:12px;background:var(--bg);border-radius:10px;padding:12px;animation:si .4s ease forwards;opacity:0}
@keyframes si{to{opacity:1;transform:translateX(0)}from{opacity:0;transform:translateX(-12px)}}
.bico{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--pl),var(--p));display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}
.bit h4{font-size:13px;font-weight:600}
.bit p{font-size:12px;color:var(--muted);margin-top:2px}
.acc{border-radius:10px;overflow:hidden;border:1px solid rgba(46,204,113,.15)}
.ach{padding:14px 16px;background:rgba(231,76,60,.07);display:flex;align-items:center;justify-content:space-between;cursor:pointer;font-weight:600;font-size:14px;color:#c0392b}
.ach-left{display:flex;align-items:center;gap:8px}
.acb{max-height:0;overflow:hidden;transition:max-height .3s}
.acb.on{max-height:500px}
.acb ul{padding:14px 16px;list-style:none}
.acb ul li{font-size:13px;color:var(--muted);padding:4px 0;display:flex;align-items:flex-start;gap:8px}
.acb ul li::before{content:'‚ö†Ô∏è';font-size:11px;margin-top:1px}
.gt{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px}
.gtb{padding:8px 14px;border-radius:50px;font-size:12px;font-weight:600;border:2px solid var(--pl);color:var(--pd);background:none;transition:.3s;display:inline-flex;align-items:center;gap:6px}
.gtb.on{background:var(--p);color:#fff;border-color:var(--p)}
.gc{font-size:13px;color:var(--muted);line-height:1.6}
.vchips{display:flex;flex-wrap:wrap;gap:8px}
.vc{display:inline-flex;align-items:center;gap:5px;padding:6px 12px;background:rgba(46,204,113,.1);border-radius:50px;font-size:12px;font-weight:500;color:var(--pd)}
.il{list-style:none}
.il li{padding:8px 0;border-bottom:1px solid rgba(46,204,113,.1);font-size:13px;display:flex;align-items:center;gap:8px}
.il li:last-child{border-bottom:none}
.il li i{color:var(--p);font-size:12px;width:14px}
.shbtn{width:100%;padding:14px;border-radius:var(--r);background:linear-gradient(135deg,var(--p),var(--pd));color:#fff;font-size:14px;font-weight:600;display:flex;align-items:center;justify-content:center;gap:8px;box-shadow:0 4px 15px rgba(46,204,113,.35);transition:.3s}
.shbtn:active{transform:scale(.97)}

/* BMI */
.bf-inp{width:100%;padding:13px 16px 13px 44px;background:var(--bg);border:2px solid rgba(46,204,113,.2);border-radius:10px;font-size:14px;color:var(--txt);font-family:inherit;margin-bottom:12px;transition:.3s}
.bf-inp:focus{border-color:var(--p);background:var(--card)}
.inp-wrap{position:relative;margin-bottom:4px}
.inp-wrap i{position:absolute;left:14px;top:50%;transform:translateY(-50%);color:var(--p);font-size:15px;pointer-events:none}
.bf-lbl{font-size:12px;font-weight:600;color:var(--muted);margin-bottom:6px;display:flex;align-items:center;gap:6px}
.bf-lbl i{color:var(--p);font-size:13px}
.cbtn{width:100%;padding:14px;background:linear-gradient(135deg,var(--p),var(--pd));color:#fff;font-size:15px;font-weight:700;border-radius:var(--r);box-shadow:0 4px 15px rgba(46,204,113,.35);transition:.3s;display:flex;align-items:center;justify-content:center;gap:8px}
.cbtn:active{transform:scale(.97)}
.br{text-align:center;padding:20px}
.bn{font-size:60px;font-weight:800;font-family:'Poppins',sans-serif}
.bc{font-size:18px;font-weight:700;margin-top:4px}
.bd{font-size:13px;color:var(--muted);margin-top:8px}
.bsc{display:flex;height:12px;border-radius:10px;overflow:hidden;margin:16px 0}
.bss{flex:1}

/* PROTEIN */
.pc{width:140px;height:140px;margin:0 auto 16px;border-radius:50%;position:relative;display:flex;align-items:center;justify-content:center;transition:background .5s}
.pc::before{content:'';position:absolute;inset:12px;background:var(--card);border-radius:50%}
.pct{position:relative;z-index:1;text-align:center}
.pct .pv{font-size:28px;font-weight:800;font-family:'Poppins',sans-serif;color:var(--pd)}
.pct .pu{font-size:11px;color:var(--muted)}
.pf{display:flex;gap:10px}
.pf input{flex:1;padding:11px 14px 11px 38px;background:var(--bg);border:2px solid rgba(46,204,113,.2);border-radius:10px;font-size:14px;color:var(--txt);font-family:inherit;transition:.3s}
.pf input:focus{border-color:var(--p)}
.pf-wrap{position:relative;flex:1}
.pf-wrap i{position:absolute;left:12px;top:50%;transform:translateY(-50%);color:var(--p);font-size:13px;pointer-events:none}
.ab{padding:11px 18px;border-radius:10px;background:var(--p);color:#fff;font-weight:600;font-size:13px;transition:.3s;display:flex;align-items:center;gap:6px}
.ab:active{transform:scale(.95)}
.qadd-btn{display:inline-flex;align-items:center;gap:6px;padding:7px 13px;background:rgba(46,204,113,.1);border-radius:50px;font-size:12px;font-weight:500;color:var(--pd);transition:.2s;cursor:pointer}
.qadd-btn:hover{background:var(--p);color:#fff}
.pl-list{list-style:none;margin-top:12px}
.pl-list li{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid rgba(46,204,113,.1);font-size:13px}
.pl-list li:last-child{border-bottom:none}
.pl-list .pli-left{display:flex;align-items:center;gap:8px}
.pl-list .pli-ico{width:28px;height:28px;border-radius:8px;background:rgba(46,204,113,.1);display:flex;align-items:center;justify-content:center;font-size:13px;color:var(--p)}
.pt{color:var(--muted);font-size:11px}
.goal-inp-wrap{position:relative}
.goal-inp-wrap i{position:absolute;left:12px;top:50%;transform:translateY(-50%);color:var(--p);font-size:13px;pointer-events:none}
.goal-inp{flex:1;padding:10px 14px 10px 36px;background:var(--bg);border:2px solid rgba(46,204,113,.2);border-radius:10px;font-size:14px;color:var(--txt)}

/* HISTORY */
.hi{display:flex;align-items:center;gap:12px;padding:12px;background:var(--card);border-radius:10px;margin-bottom:10px;box-shadow:var(--sh);cursor:pointer;transition:.3s;animation:fi .3s ease}
.hi:active{transform:scale(.98)}
.hie{font-size:28px;width:44px;text-align:center;flex-shrink:0}
.hii{flex:1}
.hii h4{font-size:14px;font-weight:600}
.hii p{font-size:12px;color:var(--muted);margin-top:2px}
.hic{font-size:13px;font-weight:700;color:var(--pd)}
.hem{text-align:center;padding:40px 20px;color:var(--muted)}
.hem i{font-size:48px;color:var(--pl);margin-bottom:12px;display:block}

/* PRIVACY */
.prc{font-size:13px;color:var(--muted);line-height:1.7}
.prc h3{font-size:15px;font-weight:700;color:var(--txt);margin:16px 0 6px;font-family:'Poppins',sans-serif;display:flex;align-items:center;gap:8px}
.prc h3 i{color:var(--p);font-size:14px}
.prc p{margin-bottom:10px}

/* TOAST */
.toast{position:fixed;bottom:calc(var(--nav) + 70px);left:50%;transform:translateX(-50%) translateY(20px);background:#1a2e1a;color:#fff;padding:10px 20px;border-radius:50px;font-size:13px;font-weight:500;z-index:999;opacity:0;transition:.3s;pointer-events:none;white-space:nowrap;display:flex;align-items:center;gap:8px}
.toast.on{opacity:1;transform:translateX(-50%) translateY(0)}

/* EXIT POPUP */
.epo{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:1000;display:none;align-items:flex-end;justify-content:center}
.epo.on{display:flex}
.ep{background:var(--card);border-radius:20px 20px 0 0;padding:24px 20px 36px;width:100%;max-width:480px;animation:su .3s ease}
@keyframes su{from{transform:translateY(100%)}to{transform:translateY(0)}}
.ep h3{font-size:18px;font-weight:700;text-align:center;margin-bottom:8px}
.ep p{font-size:13px;color:var(--muted);text-align:center;margin-bottom:20px}
.ep-acts{display:flex;flex-direction:column;gap:10px}
.ep-stay{width:100%;padding:14px;border-radius:var(--r);background:linear-gradient(135deg,var(--p),var(--pd));color:#fff;font-size:15px;font-weight:700;display:flex;align-items:center;justify-content:center;gap:8px}
.ep-leave{width:100%;padding:12px;border-radius:var(--r);color:var(--muted);font-size:14px;display:flex;align-items:center;justify-content:center;gap:6px}

/* ADS */
.adc{width:100%;min-height:60px;background:rgba(46,204,113,.04);border-radius:10px;border:1px dashed rgba(46,204,113,.2);display:flex;align-items:center;justify-content:center;margin:10px 0;overflow:hidden}
.adp{font-size:11px;color:var(--muted);text-align:center;padding:10px}

/* INTERSTITIAL */
#iad{display:none;position:fixed;inset:0;z-index:1001;background:rgba(0,0,0,.85);align-items:center;justify-content:center;flex-direction:column}
#iad.on{display:flex}
#iad-inner{background:var(--card);border-radius:20px;padding:24px;max-width:320px;width:90%;text-align:center}
#iad-close{margin-top:14px;padding:10px 24px;background:var(--p);color:#fff;border-radius:50px;font-weight:600;font-size:14px;display:inline-flex;align-items:center;gap:8px}

/* UTILS */
.hidden{display:none!important}
</style>
</head>
<body>

<!-- SPLASH -->
<div id="splash">
  <div class="sp-logo"><i class="fas fa-seedling"></i></div>
  <h1>NutriScan AI</h1>
  <p>Smart Food Nutrition Analyzer</p>
  <div class="sp-bar"><div class="sp-fill"></div></div>
</div>

<!-- FLOATING MUSIC BUTTON -->
<button class="music-fab" id="musicFab" onclick="toggleMusic()" title="Toggle Music">
  <div class="eq"><span></span><span></span><span></span><span></span></div>
</button>

<!-- APP -->
<div id="app">

  <!-- HEADER -->
  <header class="hdr">
    <div class="hl">
      <div class="hl-ico"><i class="fas fa-seedling"></i></div>
      <span>NutriScan AI</span>
    </div>
    <div class="ha">
      <button class="lg-btn" id="lgb" onclick="toggleLang()"><i class="fas fa-language"></i><span id="lgbtxt">‡§π‡§ø‡§Ç‡§¶‡•Ä</span></button>
      <button class="ic-btn" id="dkb" onclick="toggleDark()"><i class="fas fa-moon"></i></button>
      <button class="ic-btn" onclick="go('privacy')"><i class="fas fa-shield-alt"></i></button>
    </div>
  </header>

  <!-- HOME -->
  <div class="sc on" id="sc-home">
    <div class="hero">
      <h2 id="ht">Scan Food &amp;<br>Know Your Nutrition</h2>
      <p id="hs">AI-powered instant nutrition analysis</p>
      <div class="hero-acts">
        <button class="hbtn hbtn1 ripple" onclick="sfx('click');go('scan')">
          <i class="fas fa-camera"></i><span id="t-sf">Scan Food</span>
        </button>
        <button class="hbtn hbtn2 ripple" onclick="sfx('click');go('scan');document.getElementById('gi').click()">
          <i class="fas fa-image"></i><span id="t-gl">Gallery</span>
        </button>
      </div>
    </div>
    <div class="qg">
      <div class="qc ripple" onclick="sfx('tap');go('bmi')">
        <div class="qi qg2"><i class="fas fa-weight-scale"></i></div>
        <span id="t-bmi">BMI Calculator</span>
      </div>
      <div class="qc ripple" onclick="sfx('tap');go('protein')">
        <div class="qi qg3"><i class="fas fa-dumbbell"></i></div>
        <span id="t-pt">Protein Tracker</span>
      </div>
      <div class="qc ripple" onclick="sfx('tap');go('history')">
        <div class="qi qg4"><i class="fas fa-clock-rotate-left"></i></div>
        <span id="t-sh">Scan History</span>
      </div>
      <div class="qc ripple" onclick="sfx('tap');go('scan')">
        <div class="qi qg1"><i class="fas fa-bolt-lightning"></i></div>
        <span id="t-qs">Quick Scan</span>
      </div>
    </div>
    <!-- AD 1 -->
    <div class="adc"><div class="adp">üì¢ Home Banner Ad ‚Äî Paste Adstera Script Here</div></div>
    <div class="card">
      <div class="stitle"><i class="fas fa-clock"></i><span id="t-rs">Recent Scans</span></div>
      <div id="hRecent"><p style="font-size:13px;color:var(--muted);text-align:center;padding:12px 0" id="t-ns">No scans yet. Start scanning!</p></div>
    </div>
    <p style="font-size:11px;color:var(--muted);text-align:center;padding:8px" id="t-disc">‚ö†Ô∏è Estimated nutritional values for educational purposes only.</p>
  </div>

  <!-- SCAN -->
  <div class="sc" id="sc-scan">
    <div class="card">
      <div class="stitle"><i class="fas fa-camera-viewfinder"></i><span id="t-sf2">Scan Food</span></div>
      <div class="szn" onclick="sfx('click');document.getElementById('ci').click()">
        <div class="scan-icon-wrap"><i class="fas fa-camera"></i></div>
        <h3 id="t-tap">Tap to Scan</h3>
        <p id="t-pt2">Point your camera at any food item for instant nutrition info</p>
      </div>
      <div id="ipw"><img id="iprv" src="" alt="preview"></div>
      <div class="lov" id="lov">
        <div class="spin"></div>
        <p id="t-an">Analyzing nutrition data...</p>
      </div>
      <div class="sbtns" style="margin-top:12px">
        <button class="sbtn sb1 ripple" onclick="sfx('click');document.getElementById('ci').click()">
          <i class="fas fa-camera"></i><span id="t-cam">Camera</span>
        </button>
        <button class="sbtn sb2 ripple" onclick="sfx('click');document.getElementById('gi').click()">
          <i class="fas fa-folder-open"></i><span id="t-gl2">Gallery</span>
        </button>
      </div>
      <input type="file" id="ci" accept="image/*" capture="environment" style="display:none" onchange="handleImg(this)">
      <input type="file" id="gi" accept="image/*" style="display:none" onchange="handleImg(this)">
      <div style="margin-top:16px">
        <p style="font-size:12px;color:var(--muted);margin-bottom:10px;display:flex;align-items:center;gap:6px" id="t-demo">
          <i class="fas fa-utensils" style="color:var(--p)"></i> Or try a demo food:
        </p>
        <div style="display:flex;flex-wrap:wrap;gap:8px">
          <button class="demo-chip" onclick="sfx('tap');demo('apple')"><i class="fas fa-apple-whole"></i> Apple</button>
          <button class="demo-chip" onclick="sfx('tap');demo('banana')"><i class="fas fa-leaf"></i> Banana</button>
          <button class="demo-chip" onclick="sfx('tap');demo('chicken')"><i class="fas fa-drumstick-bite"></i> Chicken</button>
          <button class="demo-chip" onclick="sfx('tap');demo('rice')"><i class="fas fa-bowl-rice"></i> Rice</button>
          <button class="demo-chip" onclick="sfx('tap');demo('egg')"><i class="fas fa-egg"></i> Egg</button>
          <button class="demo-chip" onclick="sfx('tap');demo('broccoli')"><i class="fas fa-seedling"></i> Broccoli</button>
          <button class="demo-chip" onclick="sfx('tap');demo('milk')"><i class="fas fa-mug-hot"></i> Milk</button>
          <button class="demo-chip" onclick="sfx('tap');demo('oats')"><i class="fas fa-wheat-awn"></i> Oats</button>
        </div>
      </div>
    </div>
  </div>

  <!-- RESULT -->
  <div class="sc" id="sc-result"><div id="res"></div></div>

  <!-- BMI -->
  <div class="sc" id="sc-bmi">
    <div class="card">
      <div class="stitle"><i class="fas fa-weight-scale"></i><span id="t-bmi2">BMI Calculator</span></div>
      <label class="bf-lbl"><i class="fas fa-weight-hanging"></i><span id="t-wt">Weight (kg)</span></label>
      <div class="inp-wrap">
        <i class="fas fa-weight-hanging"></i>
        <input class="bf-inp" type="number" id="bw" placeholder="e.g. 70" min="1" max="300">
      </div>
      <label class="bf-lbl" style="margin-top:4px"><i class="fas fa-ruler-vertical"></i><span id="t-ht">Height (cm)</span></label>
      <div class="inp-wrap">
        <i class="fas fa-ruler-vertical"></i>
        <input class="bf-inp" type="number" id="bh" placeholder="e.g. 175" min="1" max="300">
      </div>
      <button class="cbtn ripple" onclick="sfx('click');calcBMI()">
        <i class="fas fa-calculator"></i><span id="t-calc">Calculate BMI</span>
      </button>
    </div>
    <div class="card hidden" id="bmiRes">
      <div class="br">
        <div class="bn" id="bnum"></div>
        <div class="bc" id="bcat"></div>
        <p class="bd" id="bdesc"></p>
        <div class="bsc">
          <div class="bss" style="background:#3498db"></div>
          <div class="bss" style="background:#2ecc71"></div>
          <div class="bss" style="background:#f39c12"></div>
          <div class="bss" style="background:#e74c3c"></div>
        </div>
        <div style="display:flex;justify-content:space-between;font-size:11px;color:var(--muted)">
          <span>Underweight</span><span>Normal</span><span>Overweight</span><span>Obese</span>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="stitle"><i class="fas fa-circle-info"></i>Reference</div>
      <div style="font-size:13px;color:var(--muted);line-height:2">
        <div style="display:flex;align-items:center;gap:8px"><i class="fas fa-circle" style="color:#3498db;font-size:10px"></i> <b>Below 18.5</b> ‚Äî Underweight</div>
        <div style="display:flex;align-items:center;gap:8px"><i class="fas fa-circle" style="color:#2ecc71;font-size:10px"></i> <b>18.5‚Äì24.9</b> ‚Äî Normal weight</div>
        <div style="display:flex;align-items:center;gap:8px"><i class="fas fa-circle" style="color:#f39c12;font-size:10px"></i> <b>25‚Äì29.9</b> ‚Äî Overweight</div>
        <div style="display:flex;align-items:center;gap:8px"><i class="fas fa-circle" style="color:#e74c3c;font-size:10px"></i> <b>30+</b> ‚Äî Obese</div>
      </div>
    </div>
  </div>

  <!-- PROTEIN -->
  <div class="sc" id="sc-protein">
    <div class="card">
      <div class="stitle"><i class="fas fa-dumbbell"></i><span id="t-dpt">Daily Protein Tracker</span></div>
      <div style="text-align:center;padding:20px 0">
        <div class="pc" id="pcirc">
          <div class="pct">
            <div class="pv" id="pcons">0</div>
            <div class="pu">/ <span id="pgoald">150</span>g</div>
          </div>
        </div>
        <p style="font-size:13px;color:var(--muted);display:flex;align-items:center;justify-content:center;gap:6px" id="t-pct">
          <i class="fas fa-fire" style="color:var(--p)"></i> Protein consumed today
        </p>
      </div>
      <div style="margin-bottom:14px">
        <label style="font-size:12px;font-weight:600;color:var(--muted);display:flex;align-items:center;gap:6px;margin-bottom:6px" id="t-sg">
          <i class="fas fa-bullseye" style="color:var(--p)"></i> Set Daily Goal (g)
        </label>
        <div style="display:flex;gap:8px">
          <div class="goal-inp-wrap" style="flex:1">
            <i class="fas fa-bullseye"></i>
            <input type="number" id="pgi" value="150" min="10" max="500" class="goal-inp">
          </div>
          <button class="ab ripple" onclick="sfx('click');setGoalP()"><i class="fas fa-check"></i> Set</button>
        </div>
      </div>
      <div>
        <label style="font-size:12px;font-weight:600;color:var(--muted);display:flex;align-items:center;gap:6px;margin-bottom:6px" id="t-ap">
          <i class="fas fa-plus-circle" style="color:var(--p)"></i> Add Protein (g)
        </label>
        <div class="pf">
          <div class="pf-wrap">
            <i class="fas fa-drumstick-bite"></i>
            <input type="number" id="padd" placeholder="e.g. 25" min="1">
          </div>
          <button class="ab ripple" onclick="sfx('tap');addP()"><i class="fas fa-plus"></i> Add</button>
        </div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:14px">
        <button class="qadd-btn" onclick="sfx('tap');qadd(20,'Chicken Breast','fa-drumstick-bite')"><i class="fas fa-drumstick-bite"></i> +20g Chicken</button>
        <button class="qadd-btn" onclick="sfx('tap');qadd(6,'Egg','fa-egg')"><i class="fas fa-egg"></i> +6g Egg</button>
        <button class="qadd-btn" onclick="sfx('tap');qadd(8,'Milk','fa-mug-hot')"><i class="fas fa-mug-hot"></i> +8g Milk</button>
        <button class="qadd-btn" onclick="sfx('tap');qadd(25,'Whey Protein','fa-jar')"><i class="fas fa-jar"></i> +25g Whey</button>
      </div>
    </div>
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
        <div class="stitle" style="margin:0"><i class="fas fa-list-check"></i> Today's Log</div>
        <button onclick="sfx('tap');resetP()" style="font-size:12px;color:var(--muted);display:flex;align-items:center;gap:4px">
          <i class="fas fa-rotate-left"></i> Reset
        </button>
      </div>
      <ul class="pl-list" id="plog"><li style="color:var(--muted);font-size:13px" id="t-ne">No entries yet</li></ul>
    </div>
  </div>

  <!-- HISTORY -->
  <div class="sc" id="sc-history">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px">
      <h2 style="font-size:18px;font-weight:700;display:flex;align-items:center;gap:8px" id="t-sh2">
        <i class="fas fa-clock-rotate-left" style="color:var(--p)"></i> Scan History
      </h2>
      <button onclick="sfx('tap');clearH()" style="font-size:12px;color:#e74c3c;font-weight:600;display:flex;align-items:center;gap:4px">
        <i class="fas fa-trash"></i> Clear
      </button>
    </div>
    <div id="hlist"></div>
    <!-- AD 4 -->
    <div class="adc"><div class="adp">üì¢ History Banner Ad ‚Äî Paste Adstera Script Here</div></div>
  </div>

  <!-- PRIVACY -->
  <div class="sc" id="sc-privacy">
    <div class="card">
      <div class="stitle"><i class="fas fa-shield-halved"></i>Privacy Policy</div>
      <div class="prc">
        <p><b>Last Updated: 2024.</b> This Privacy Policy describes how NutriScan AI handles your data.</p>
        <h3><i class="fas fa-user-shield"></i>1. No Personal Data Collection</h3>
        <p>NutriScan AI does not collect, store, or transmit any personally identifiable information. All data is stored locally on your device using localStorage.</p>
        <h3><i class="fas fa-image"></i>2. Images Not Uploaded</h3>
        <p>Images you capture or select are processed entirely on your device. No images are uploaded to any server.</p>
        <h3><i class="fas fa-graduation-cap"></i>3. Educational Purpose Only</h3>
        <p>All nutritional values are estimated values for educational purposes only. This app does not provide medical advice.</p>
        <h3><i class="fas fa-rectangle-ad"></i>4. Third-Party Advertisements</h3>
        <p>This app may display ads served by Adstera. These third-party services may use cookies per their own privacy policies.</p>
        <h3><i class="fas fa-database"></i>5. Local Storage</h3>
        <p>The app uses localStorage to save scan history, protein tracker data, and preferences. This data never leaves your device.</p>
        <h3><i class="fas fa-envelope"></i>6. Contact</h3>
        <p>privacy@nutriscanai.app</p>
        <div style="margin-top:16px;padding:12px;background:rgba(46,204,113,.08);border-radius:10px;font-size:12px;display:flex;gap:8px;align-items:flex-start">
          <i class="fas fa-triangle-exclamation" style="color:#f39c12;margin-top:1px"></i>
          <span><b>Disclaimer:</b> This app provides estimated nutritional values for educational purposes only. Do not use as a substitute for professional medical advice.</span>
        </div>
      </div>
    </div>
  </div>

  <!-- BOTTOM NAV -->
  <nav class="bnav">
    <button class="ni on" id="n-home" onclick="sfx('nav');go('home')">
      <i class="fas fa-house"></i><span id="t-hm">Home</span>
    </button>
    <button class="ni" id="n-bmi" onclick="sfx('nav');go('bmi')">
      <i class="fas fa-weight-scale"></i><span>BMI</span>
    </button>
    <button class="nsb ripple" onclick="sfx('scan');go('scan')">
      <i class="fas fa-camera"></i>
    </button>
    <button class="ni" id="n-protein" onclick="sfx('nav');go('protein')">
      <i class="fas fa-dumbbell"></i><span id="t-pr">Protein</span>
    </button>
    <button class="ni" id="n-history" onclick="sfx('nav');go('history')">
      <i class="fas fa-clock-rotate-left"></i><span id="t-hi">History</span>
    </button>
  </nav>
</div>

<!-- TOAST -->
<div class="toast" id="toast"><i class="fas fa-check-circle" id="toastIco"></i><span id="toastTxt"></span></div>

<!-- EXIT POPUP -->
<div class="epo" id="epo">
  <div class="ep">
    <div class="adc" style="margin-bottom:16px"><div class="adp">üì¢ Exit Popup Ad ‚Äî Paste Adstera Script Here</div></div>
    <h3>üëã Leaving so soon?</h3>
    <p id="t-em">Keep tracking your nutrition for better health!</p>
    <div class="ep-acts">
      <button class="ep-stay ripple" onclick="sfx('click');closeExit()">
        <i class="fas fa-heart"></i> Stay &amp; Keep Scanning
      </button>
      <button class="ep-leave" onclick="window.history.back()">
        <i class="fas fa-arrow-right-from-bracket"></i> Maybe later
      </button>
    </div>
  </div>
</div>

<!-- INTERSTITIAL -->
<div id="iad">
  <div id="iad-inner">
    <div class="adc" style="min-height:250px"><div class="adp">üì¢ Interstitial Ad ‚Äî Paste Adstera Script Here</div></div>
    <button id="iad-close" onclick="closeIad()"><i class="fas fa-play"></i> Continue</button>
  </div>
</div>

<script>
// ============================================================
// SOUND ENGINE ‚Äî Web Audio API (no external files needed!)
// ============================================================
var AC = null;
var musicOn = true;
var musicNodes = {};

function getAC(){
  if(!AC){
    try{ AC = new (window.AudioContext||window.webkitAudioContext)(); }catch(e){}
  }
  return AC;
}

// Sound effects using Web Audio API
function sfx(type){
  if(!musicOn) return;
  var ac = getAC(); if(!ac) return;
  var o, g;
  try{
    o = ac.createOscillator();
    g = ac.createGain();
    o.connect(g); g.connect(ac.destination);
    if(type==='click'){
      o.type='sine'; o.frequency.setValueAtTime(880,ac.currentTime);
      o.frequency.exponentialRampToValueAtTime(440,ac.currentTime+.1);
      g.gain.setValueAtTime(.15,ac.currentTime);
      g.gain.exponentialRampToValueAtTime(.001,ac.currentTime+.12);
      o.start(ac.currentTime); o.stop(ac.currentTime+.12);
    } else if(type==='tap'){
      o.type='sine'; o.frequency.setValueAtTime(660,ac.currentTime);
      o.frequency.exponentialRampToValueAtTime(330,ac.currentTime+.08);
      g.gain.setValueAtTime(.1,ac.currentTime);
      g.gain.exponentialRampToValueAtTime(.001,ac.currentTime+.1);
      o.start(ac.currentTime); o.stop(ac.currentTime+.1);
    } else if(type==='nav'){
      o.type='triangle'; o.frequency.setValueAtTime(523,ac.currentTime);
      g.gain.setValueAtTime(.08,ac.currentTime);
      g.gain.exponentialRampToValueAtTime(.001,ac.currentTime+.08);
      o.start(ac.currentTime); o.stop(ac.currentTime+.08);
    } else if(type==='scan'){
      // Camera shutter sound
      playScanSound(ac);
      return;
    } else if(type==='success'){
      playSuccessSound(ac);
      return;
    } else if(type==='error'){
      o.type='sawtooth'; o.frequency.setValueAtTime(220,ac.currentTime);
      g.gain.setValueAtTime(.1,ac.currentTime);
      g.gain.exponentialRampToValueAtTime(.001,ac.currentTime+.2);
      o.start(ac.currentTime); o.stop(ac.currentTime+.2);
    }
  }catch(e){}
}

function playScanSound(ac){
  try{
    // Click + whirr
    var o1=ac.createOscillator(), g1=ac.createGain();
    o1.connect(g1); g1.connect(ac.destination);
    o1.type='square'; o1.frequency.setValueAtTime(1200,ac.currentTime);
    o1.frequency.exponentialRampToValueAtTime(200,ac.currentTime+.15);
    g1.gain.setValueAtTime(.2,ac.currentTime);
    g1.gain.exponentialRampToValueAtTime(.001,ac.currentTime+.15);
    o1.start(ac.currentTime); o1.stop(ac.currentTime+.15);
    // Bip confirmation
    var o2=ac.createOscillator(), g2=ac.createGain();
    o2.connect(g2); g2.connect(ac.destination);
    o2.type='sine'; o2.frequency.setValueAtTime(1000,ac.currentTime+.1);
    g2.gain.setValueAtTime(0,ac.currentTime+.1);
    g2.gain.setValueAtTime(.15,ac.currentTime+.12);
    g2.gain.exponentialRampToValueAtTime(.001,ac.currentTime+.25);
    o2.start(ac.currentTime+.1); o2.stop(ac.currentTime+.25);
  }catch(e){}
}

function playSuccessSound(ac){
  try{
    // Ascending ding ding ding
    var notes=[523,659,784,1047];
    notes.forEach(function(freq,i){
      var o=ac.createOscillator(), g=ac.createGain();
      o.connect(g); g.connect(ac.destination);
      o.type='sine'; o.frequency.value=freq;
      var t=ac.currentTime+i*.12;
      g.gain.setValueAtTime(0,t);
      g.gain.linearRampToValueAtTime(.18,t+.04);
      g.gain.exponentialRampToValueAtTime(.001,t+.18);
      o.start(t); o.stop(t+.18);
    });
  }catch(e){}
}

// Background ambient music (soft nature/health vibe)
function startBgMusic(){
  var ac=getAC(); if(!ac) return;
  try{
    stopBgMusic();
    // Soft ambient chord loop
    playAmbientLoop(ac);
  }catch(e){}
}

var ambientTimer=null;
var ambientPlaying=false;

function playAmbientLoop(ac){
  if(!musicOn||!ambientPlaying) return;
  try{
    // Soft pad ‚Äî two gentle notes
    var chords=[[261,329,392],[293,370,440],[246,311,392],[261,329,392]];
    var duration=3.5;
    chords.forEach(function(chord,ci){
      chord.forEach(function(freq){
        var o=ac.createOscillator(), g=ac.createGain(), filt=ac.createBiquadFilter();
        o.connect(filt); filt.connect(g); g.connect(ac.destination);
        o.type='sine'; o.frequency.value=freq;
        filt.type='lowpass'; filt.frequency.value=800;
        var t=ac.currentTime+ci*duration;
        g.gain.setValueAtTime(0,t);
        g.gain.linearRampToValueAtTime(.025,t+.5);
        g.gain.setValueAtTime(.025,t+duration-.5);
        g.gain.linearRampToValueAtTime(0,t+duration);
        o.start(t); o.stop(t+duration);
      });
    });
    ambientTimer=setTimeout(function(){
      if(musicOn&&ambientPlaying) playAmbientLoop(ac);
    }, chords.length*duration*1000-500);
  }catch(e){}
}

function stopBgMusic(){
  ambientPlaying=false;
  if(ambientTimer){clearTimeout(ambientTimer);ambientTimer=null;}
}

function toggleMusic(){
  var ac=getAC();
  if(ac&&ac.state==='suspended') ac.resume();
  musicOn=!musicOn;
  var fab=document.getElementById('musicFab');
  fab.classList.toggle('muted',!musicOn);
  if(musicOn){
    ambientPlaying=true;
    var bgac=getAC();
    if(bgac) playAmbientLoop(bgac);
    toast('üéµ Music On');
  } else {
    stopBgMusic();
    toast('üîá Music Off');
  }
  localStorage.setItem('mu',musicOn?'1':'0');
}

// ============================================================
// DATA
// ============================================================
var DB={
  apple:{name:"Apple",emoji:"üçé",icon:"fa-apple-whole",serving:"1 medium (182g)",calories:95,protein:.5,carbs:25,fat:.3,fiber:4.4,vitamins:["Vitamin C","Vitamin B6","Vitamin K","Potassium","Folate"],ingredients:["Natural Fructose","Dietary Fiber","Quercetin","Catechin","Chlorogenic Acid","Pectin"],benefits:[{i:"‚ù§Ô∏è",t:"Heart Health",d:"Rich in flavonoids that may reduce heart disease risk"},{i:"ü¶∑",t:"Dental Health",d:"Stimulates saliva, reducing tooth decay"},{i:"üß†",t:"Brain Boost",d:"Quercetin may protect brain cells from oxidative stress"},{i:"üí™",t:"Immune Support",d:"Good source of Vitamin C"},{i:"‚öñÔ∏è",t:"Weight Management",d:"High fiber promotes feelings of fullness"}],side:["May cause bloating in sensitive individuals","High in natural sugars ‚Äî moderate for diabetics","Pesticide residue ‚Äî prefer organic or wash thoroughly","Seeds contain amygdalin ‚Äî avoid in large amounts"]},
  banana:{name:"Banana",emoji:"üçå",icon:"fa-leaf",serving:"1 medium (118g)",calories:105,protein:1.3,carbs:27,fat:.4,fiber:3.1,vitamins:["Vitamin B6","Vitamin C","Potassium","Magnesium","Folate"],ingredients:["Natural Sugars","Resistant Starch","Pectin","Dopamine","Catechins","Potassium Compounds"],benefits:[{i:"‚ö°",t:"Energy Boost",d:"Quick-release carbs provide instant energy"},{i:"üí™",t:"Muscle Recovery",d:"Potassium helps prevent muscle cramps"},{i:"üòä",t:"Mood Enhancer",d:"Contains tryptophan, a serotonin precursor"},{i:"ü´Ä",t:"Heart Support",d:"High potassium helps regulate blood pressure"},{i:"üçΩÔ∏è",t:"Digestive Health",d:"Pectin and resistant starch support gut health"}],side:["High sugar ‚Äî consume moderately if diabetic","Overripe bananas have higher glycemic index","May trigger migraines in susceptible individuals","Excessive intake risky for kidney patients"]},
  chicken:{name:"Chicken Breast",emoji:"üçó",icon:"fa-drumstick-bite",serving:"100g cooked",calories:165,protein:31,carbs:0,fat:3.6,fiber:0,vitamins:["Niacin (B3)","Vitamin B6","Phosphorus","Selenium","Vitamin B12"],ingredients:["Complete Proteins","Myosin","Actin","Collagen","Essential Amino Acids","Creatine"],benefits:[{i:"üí™",t:"Muscle Building",d:"Excellent complete protein for muscle synthesis"},{i:"‚öñÔ∏è",t:"Weight Loss",d:"High protein keeps you full longer"},{i:"ü¶¥",t:"Bone Health",d:"Phosphorus supports strong bones"},{i:"üß†",t:"Brain Function",d:"Niacin supports cognitive performance"},{i:"üõ°Ô∏è",t:"Immune Boost",d:"Selenium acts as an antioxidant"}],side:["Undercooked chicken risks Salmonella","Processed forms may have high sodium","High purine content may trigger gout","Factory-farmed may contain antibiotic residues"]},
  rice:{name:"White Rice",emoji:"üçö",icon:"fa-bowl-rice",serving:"1 cup cooked (186g)",calories:242,protein:4.4,carbs:53,fat:.4,fiber:.6,vitamins:["Thiamine (B1)","Niacin","Iron","Manganese","Folate"],ingredients:["Starch","Amylose","Amylopectin","Rice Protein","Trace Minerals"],benefits:[{i:"‚ö°",t:"Quick Energy",d:"Easily digestible carbs provide fast fuel"},{i:"üçΩÔ∏è",t:"Gentle on Gut",d:"Bland and easy to digest"},{i:"üíß",t:"Hydration",d:"Absorbs water during cooking"},{i:"üåæ",t:"Gluten-Free",d:"Safe for celiac or gluten sensitivity"},{i:"‚öñÔ∏è",t:"Versatile Staple",d:"Pairs well with proteins and vegetables"}],side:["High glycemic index ‚Äî spikes blood sugar","Low fiber vs brown rice","Excessive consumption linked to diabetes risk","Arsenic content in some varieties"]},
  egg:{name:"Egg",emoji:"ü•ö",icon:"fa-egg",serving:"1 large (50g)",calories:72,protein:6,carbs:.4,fat:5,fiber:0,vitamins:["Vitamin D","Vitamin B12","Choline","Selenium","Riboflavin"],ingredients:["Complete Protein","Lutein","Zeaxanthin","Choline","Omega-3","Lecithin"],benefits:[{i:"üí™",t:"Complete Protein",d:"Contains all 9 essential amino acids"},{i:"üëÅÔ∏è",t:"Eye Health",d:"Lutein and zeaxanthin protect against macular degeneration"},{i:"üß†",t:"Brain Health",d:"Choline is crucial for brain function"},{i:"ü¶¥",t:"Bone Strength",d:"Vitamin D supports calcium absorption"},{i:"‚öñÔ∏è",t:"Satiety",d:"High protein keeps hunger at bay"}],side:["High cholesterol in yolk","Salmonella risk if undercooked","Egg allergies common in children","Raw egg white may cause biotin deficiency"]},
  broccoli:{name:"Broccoli",emoji:"ü•¶",icon:"fa-seedling",serving:"1 cup (91g)",calories:31,protein:2.6,carbs:6,fat:.3,fiber:2.4,vitamins:["Vitamin C","Vitamin K","Folate","Vitamin A","Potassium"],ingredients:["Sulforaphane","Indole-3-Carbinol","Glucosinolates","Kaempferol","Chlorophyll","Beta-Carotene"],benefits:[{i:"üõ°Ô∏è",t:"Cancer Protection",d:"Sulforaphane has powerful anti-cancer properties"},{i:"‚ù§Ô∏è",t:"Heart Health",d:"Fiber and antioxidants reduce cardiovascular risk"},{i:"ü¶¥",t:"Bone Health",d:"Vitamin K and calcium support strong bones"},{i:"üß¨",t:"Anti-inflammatory",d:"Rich in antioxidants that combat inflammation"},{i:"üíß",t:"Detox Support",d:"Glucosinolates support liver detoxification"}],side:["May cause gas and bloating","High Vitamin K may interfere with blood thinners","Thyroid-sensitive should moderate intake","Raw broccoli harder to digest than cooked"]},
  milk:{name:"Whole Milk",emoji:"ü•õ",icon:"fa-mug-hot",serving:"1 cup (240ml)",calories:149,protein:8,carbs:12,fat:8,fiber:0,vitamins:["Calcium","Vitamin D","Vitamin B12","Riboflavin","Phosphorus"],ingredients:["Whey Protein","Casein","Lactose","Saturated Fats","Calcium Phosphate","CLA"],benefits:[{i:"ü¶¥",t:"Strong Bones",d:"Excellent source of calcium and Vitamin D"},{i:"üí™",t:"Muscle Repair",d:"Casein provides slow-release protein overnight"},{i:"üß†",t:"Brain Function",d:"Choline and B12 support brain health"},{i:"üò¥",t:"Sleep Aid",d:"Tryptophan may promote better sleep"},{i:"‚ö°",t:"Sustained Energy",d:"Balanced macros for steady energy"}],side:["Lactose intolerance affects many adults","High in saturated fat","Dairy allergies possible","Hormones in commercial milk concern some"]},
  oats:{name:"Oats",emoji:"üåæ",icon:"fa-wheat-awn",serving:"¬Ω cup dry (40g)",calories:154,protein:5.3,carbs:27,fat:2.6,fiber:4,vitamins:["Manganese","Phosphorus","Magnesium","Vitamin B1","Iron","Zinc"],ingredients:["Beta-Glucan","Avenin Protein","Phytic Acid","Avenanthramides","Soluble Fiber","Complex Carbohydrates"],benefits:[{i:"‚ù§Ô∏è",t:"Heart Health",d:"Beta-glucan reduces LDL cholesterol"},{i:"üíâ",t:"Blood Sugar Control",d:"Improves insulin sensitivity"},{i:"üçΩÔ∏è",t:"Digestive Health",d:"High fiber promotes healthy gut bacteria"},{i:"‚öñÔ∏è",t:"Weight Management",d:"Beta-glucan increases satiety hormones"},{i:"‚ö°",t:"Sustained Energy",d:"Complex carbs release energy slowly"}],side:["Phytic acid may reduce mineral absorption","Gluten contamination possible for celiac","May cause initial bloating","Raw oats harder to digest"]}
};

var GOALS={
  loss:{en:"Great for weight loss! Use smaller portions, pair with fiber-rich veggies. Avoid high-calorie sauces. Aim for 300‚Äì500 calorie daily deficit. Stay hydrated, exercise 150+ min/week.",hi:"‡§µ‡§ú‡§® ‡§ï‡§Æ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§ö‡•ç‡§õ‡§æ! ‡§õ‡•ã‡§ü‡•á ‡§π‡§ø‡§∏‡•ç‡§∏‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§ñ‡§æ‡§è‡§Ç‡•§ ‡§´‡§æ‡§á‡§¨‡§∞ ‡§Ø‡•Å‡§ï‡•ç‡§§ ‡§∏‡§¨‡•ç‡§ú‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§∏‡§æ‡§• ‡§≤‡•á‡§Ç‡•§ ‡§∞‡•ã‡§ú 300-500 ‡§ï‡•à‡§≤‡•ã‡§∞‡•Ä ‡§ï‡§Æ ‡§ï‡§∞‡•á‡§Ç‡•§"},
  muscle:{en:"Excellent for muscle gain! Consume within 30 min post-workout. Target 1.6‚Äì2.2g protein per kg body weight daily. Prioritize sleep and progressive overload.",hi:"‡§Æ‡§æ‡§Ç‡§∏‡§™‡•á‡§∂‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§§‡•ç‡§ï‡•É‡§∑‡•ç‡§ü! ‡§µ‡§∞‡•ç‡§ï‡§Ü‡§â‡§ü ‡§ï‡•á 30 ‡§Æ‡§ø‡§®‡§ü ‡§¨‡§æ‡§¶ ‡§ñ‡§æ‡§è‡§Ç‡•§ 1.6-2.2 ‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§™‡•ç‡§∞‡•ã‡§ü‡•Ä‡§® ‡§™‡•ç‡§∞‡§§‡§ø ‡§ï‡§ø‡§≤‡•ã ‡§≤‡•á‡§Ç‡•§"},
  gain:{en:"Good for weight gain! Increase portions by 1.5x. Add healthy fats like nuts. Eat every 3‚Äì4 hours. Target 300‚Äì500 calorie daily surplus.",hi:"‡§µ‡§ú‡§® ‡§¨‡§¢‡§º‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§ö‡•ç‡§õ‡§æ! ‡§π‡§ø‡§∏‡•ç‡§∏‡§æ 1.5 ‡§ó‡•Å‡§®‡§æ ‡§¨‡§¢‡§º‡§æ‡§è‡§Ç‡•§ ‡§®‡§ü‡•ç‡§∏ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç‡•§ ‡§π‡§∞ 3-4 ‡§ò‡§Ç‡§ü‡•á ‡§ñ‡§æ‡§è‡§Ç‡•§"}
};

var LANG_DATA={
  ht:{en:"Scan Food &\nKnow Your Nutrition",hi:"‡§ñ‡§æ‡§®‡§æ ‡§∏‡•ç‡§ï‡•à‡§® ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞\n‡§™‡•ã‡§∑‡§£ ‡§ú‡§æ‡§®‡•á‡§Ç"},
  hs:{en:"AI-powered instant nutrition analysis",hi:"AI ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§§‡§§‡•ç‡§ï‡§æ‡§≤ ‡§™‡•ã‡§∑‡§£ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£"},
  "t-sf":{en:"Scan Food",hi:"‡§ñ‡§æ‡§®‡§æ ‡§∏‡•ç‡§ï‡•à‡§® ‡§ï‡§∞‡•á‡§Ç"},"t-sf2":{en:"Scan Food",hi:"‡§ñ‡§æ‡§®‡§æ ‡§∏‡•ç‡§ï‡•à‡§® ‡§ï‡§∞‡•á‡§Ç"},
  "t-gl":{en:"Gallery",hi:"‡§ó‡•à‡§≤‡§∞‡•Ä"},"t-gl2":{en:"Gallery",hi:"‡§ó‡•à‡§≤‡§∞‡•Ä"},
  "t-bmi":{en:"BMI Calculator",hi:"BMI ‡§ï‡•à‡§≤‡§ï‡•Å‡§≤‡•á‡§ü‡§∞"},"t-bmi2":{en:"BMI Calculator",hi:"BMI ‡§ï‡•à‡§≤‡§ï‡•Å‡§≤‡•á‡§ü‡§∞"},
  "t-pt":{en:"Protein Tracker",hi:"‡§™‡•ç‡§∞‡•ã‡§ü‡•Ä‡§® ‡§ü‡•ç‡§∞‡•à‡§ï‡§∞"},"t-dpt":{en:"Daily Protein Tracker",hi:"‡§¶‡•à‡§®‡§ø‡§ï ‡§™‡•ç‡§∞‡•ã‡§ü‡•Ä‡§® ‡§ü‡•ç‡§∞‡•à‡§ï‡§∞"},
  "t-sh":{en:"Scan History",hi:"‡§∏‡•ç‡§ï‡•à‡§® ‡§á‡§§‡§ø‡§π‡§æ‡§∏"},"t-sh2":{en:"Scan History",hi:"‡§∏‡•ç‡§ï‡•à‡§® ‡§á‡§§‡§ø‡§π‡§æ‡§∏"},
  "t-qs":{en:"Quick Scan",hi:"‡§§‡•ç‡§µ‡§∞‡§ø‡§§ ‡§∏‡•ç‡§ï‡•à‡§®"},
  "t-rs":{en:"Recent Scans",hi:"‡§π‡§æ‡§≤ ‡§ï‡•á ‡§∏‡•ç‡§ï‡•à‡§®"},
  "t-ns":{en:"No scans yet. Start scanning!",hi:"‡§Ö‡§≠‡•Ä ‡§ï‡•ã‡§à ‡§∏‡•ç‡§ï‡•à‡§® ‡§®‡§π‡•Ä‡§Ç‡•§ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç!"},
  "t-disc":{en:"‚ö†Ô∏è Estimated values for educational purposes only.",hi:"‚ö†Ô∏è ‡§ï‡•á‡§µ‡§≤ ‡§∂‡•à‡§ï‡•ç‡§∑‡§ø‡§ï ‡§â‡§¶‡•ç‡§¶‡•á‡§∂‡•ç‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§®‡•Å‡§Æ‡§æ‡§®‡§ø‡§§ ‡§Æ‡•Ç‡§≤‡•ç‡§Ø‡•§"},
  "t-tap":{en:"Tap to Scan",hi:"‡§∏‡•ç‡§ï‡•à‡§® ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ü‡•à‡§™ ‡§ï‡§∞‡•á‡§Ç"},
  "t-pt2":{en:"Point camera at any food for nutrition info",hi:"‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§ñ‡§æ‡§®‡•á ‡§™‡§∞ ‡§ï‡•à‡§Æ‡§∞‡§æ ‡§≤‡§ó‡§æ‡§è‡§Ç"},
  "t-an":{en:"Analyzing nutrition data...",hi:"‡§™‡•ã‡§∑‡§£ ‡§°‡•á‡§ü‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à..."},
  "t-demo":{en:"Or try a demo food:",hi:"‡§Ø‡§æ ‡§è‡§ï ‡§°‡•á‡§Æ‡•ã ‡§ñ‡§æ‡§®‡§æ ‡§Ü‡§ú‡§º‡§Æ‡§æ‡§è‡§Ç:"},
  "t-cam":{en:"Camera",hi:"‡§ï‡•à‡§Æ‡§∞‡§æ"},
  "t-calc":{en:"Calculate BMI",hi:"BMI ‡§ï‡•à‡§≤‡§ï‡•Å‡§≤‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç"},
  "t-wt":{en:"Weight (kg)",hi:"‡§µ‡§ú‡§® (‡§ï‡§ø‡§ó‡•ç‡§∞‡§æ)"},"t-ht":{en:"Height (cm)",hi:"‡§ä‡§Ç‡§ö‡§æ‡§à (‡§∏‡•á‡§Æ‡•Ä)"},
  "t-pct":{en:"Protein consumed today",hi:"‡§Ü‡§ú ‡§ï‡§æ ‡§™‡•ç‡§∞‡•ã‡§ü‡•Ä‡§® ‡§∏‡•á‡§µ‡§®"},
  "t-sg":{en:"Set Daily Goal (g)",hi:"‡§¶‡•à‡§®‡§ø‡§ï ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø (‡§ó‡•ç‡§∞‡§æ‡§Æ)"},
  "t-ap":{en:"Add Protein (g)",hi:"‡§™‡•ç‡§∞‡•ã‡§ü‡•Ä‡§® ‡§ú‡•ã‡§°‡§º‡•á‡§Ç (‡§ó‡•ç‡§∞‡§æ‡§Æ)"},
  "t-ne":{en:"No entries yet",hi:"‡§Ö‡§≠‡•Ä ‡§ï‡•ã‡§à ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø ‡§®‡§π‡•Ä‡§Ç"},
  "t-hm":{en:"Home",hi:"‡§π‡•ã‡§Æ"},"t-pr":{en:"Protein",hi:"‡§™‡•ç‡§∞‡•ã‡§ü‡•Ä‡§®"},"t-hi":{en:"History",hi:"‡§á‡§§‡§ø‡§π‡§æ‡§∏"},
  "t-em":{en:"Keep tracking your nutrition for better health!",hi:"‡§¨‡•á‡§π‡§§‡§∞ ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡•ã‡§∑‡§£ ‡§ü‡•ç‡§∞‡•à‡§ï ‡§ï‡§∞‡§§‡•á ‡§∞‡§π‡•á‡§Ç!"}
};

// STATE
var lang='en', dark=false, food=null;
var scanCount=parseInt(localStorage.getItem('sc')||'0');
var history_=JSON.parse(localStorage.getItem('sh')||'[]');
var pdata=JSON.parse(localStorage.getItem('pd')||'{"goal":150,"consumed":0,"log":[]}');
var curGoal='loss';

// SPLASH ‚Üí APP
setTimeout(function(){
  var sp=document.getElementById('splash');
  var app=document.getElementById('app');
  sp.classList.add('hide');
  setTimeout(function(){
    sp.style.display='none';
    app.classList.add('on');
    renderRecent();renderH();renderP();
    // Start ambient music after user gesture ‚Äî wait for first interaction
    document.addEventListener('click', function startMusicOnce(){
      var ac=getAC();
      if(ac&&ac.state==='suspended') ac.resume();
      if(musicOn){ambientPlaying=true;var bgac=getAC();if(bgac)playAmbientLoop(bgac);}
      document.removeEventListener('click',startMusicOnce);
    }, {once:true});
  },600);
},2500);

// NAVIGATE
function go(name){
  document.querySelectorAll('.sc').forEach(function(s){s.classList.remove('on')});
  document.querySelectorAll('.ni').forEach(function(n){n.classList.remove('on')});
  var s=document.getElementById('sc-'+name);
  if(s)s.classList.add('on');
  var n=document.getElementById('n-'+name);
  if(n)n.classList.add('on');
  window.scrollTo(0,0);
  if(name==='history')renderH();
  if(name==='protein')renderP();
  if(name==='home')renderRecent();
}

// DARK MODE
function toggleDark(){
  sfx('tap');
  dark=!dark;
  document.documentElement.setAttribute('data-dark',dark?'1':'');
  if(!dark)document.documentElement.removeAttribute('data-dark');
  document.getElementById('dkb').innerHTML='<i class="fas fa-'+(dark?'sun':'moon')+'"></i>';
  localStorage.setItem('dk',dark?'1':'0');
}

// LANGUAGE
function toggleLang(){
  sfx('tap');
  lang=lang==='en'?'hi':'en';
  document.getElementById('lgbtxt').textContent=lang==='en'?'‡§π‡§ø‡§Ç‡§¶‡•Ä':'English';
  for(var k in LANG_DATA){
    var el=document.getElementById(k);
    if(el)el.textContent=LANG_DATA[k][lang];
  }
}

// IMAGE UPLOAD
function handleImg(inp){
  if(!inp.files||!inp.files[0])return;
  var file=inp.files[0];
  var r=new FileReader();
  r.onload=function(e){
    var pv=document.getElementById('iprv');
    var pw=document.getElementById('ipw');
    pv.src=e.target.result;
    pw.style.display='block';
    go('scan');
    sfx('scan');
    var lov=document.getElementById('lov');
    lov.classList.add('on');
    var fn=file.name.toLowerCase();
    var matched=null;
    for(var k in DB){if(fn.includes(k)){matched=k;break;}}
    if(!matched){var keys=Object.keys(DB);matched=keys[Math.floor(Math.random()*keys.length)];}
    var img=e.target.result;
    setTimeout(function(){lov.classList.remove('on');sfx('success');analyze(matched,img);},2000);
  };
  r.readAsDataURL(file);
  inp.value='';
}

// DEMO
function demo(k){
  go('scan');
  sfx('scan');
  document.getElementById('ipw').style.display='none';
  var lov=document.getElementById('lov');
  lov.classList.add('on');
  setTimeout(function(){lov.classList.remove('on');sfx('success');analyze(k,null);},1800);
}

// ANALYZE
function analyze(k,img){
  var f=DB[k]; if(!f)return;
  food=Object.assign({},f,{img:img,ts:Date.now()});
  history_.unshift(food);
  if(history_.length>10)history_=history_.slice(0,10);
  localStorage.setItem('sh',JSON.stringify(history_));
  scanCount++;
  localStorage.setItem('sc',scanCount);
  renderResult(f,img);
  go('result');
  if(scanCount%3===0)setTimeout(showIad,500);
  if(f.protein>0){
    pdata.consumed+=f.protein;
    if(!pdata.log)pdata.log=[];
    pdata.log.unshift({s:f.name,ico:f.icon||'fa-utensils',a:f.protein,t:new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})});
    saveP();
  }
}

// RENDER RESULT
function renderResult(f,img){
  var pp=Math.min(100,(f.protein/50)*100);
  var cp=Math.min(100,(f.carbs/100)*100);
  var fp=Math.min(100,(f.fat/65)*100);
  var fip=f.fiber?Math.min(100,(f.fiber/30)*100):0;

  var html='<span class="disc"><i class="fas fa-triangle-exclamation"></i> Estimated ‚Äî Educational purpose only</span>';
  html+='<div class="rfh">';
  if(img){html+='<img src="'+img+'" style="width:70px;height:70px;border-radius:14px;object-fit:cover;flex-shrink:0" alt="food">';}
  else{html+='<div class="rfip">'+f.emoji+'</div>';}
  html+='<div><div class="rfn">'+f.emoji+' '+f.name+'</div><div class="rfs"><i class="fas fa-ruler-combined" style="color:var(--p);font-size:11px"></i> '+f.serving+'</div></div></div>';

  // Macros
  html+='<div class="card"><div class="stitle"><i class="fas fa-fire-flame-curved"></i>Nutrition Facts</div>';
  html+='<div class="mg">';
  html+='<div class="mi mc"><div class="mv">'+f.calories+'</div><div class="ml"><i class="fas fa-fire-flame-curved"></i> Calories (kcal)</div></div>';
  html+='<div class="mi mp"><div class="mv">'+f.protein+'g</div><div class="ml"><i class="fas fa-dumbbell"></i> Protein</div></div>';
  html+='<div class="mi mca"><div class="mv">'+f.carbs+'g</div><div class="ml"><i class="fas fa-wheat-awn"></i> Carbs</div></div>';
  html+='<div class="mi mf"><div class="mv">'+f.fat+'g</div><div class="ml"><i class="fas fa-droplet"></i> Fat</div></div>';
  html+='</div>';
  html+='<div style="margin-top:16px">';
  html+=bar('Protein','fa-dumbbell',f.protein+'g',pp,'#e74c3c');
  html+=bar('Carbohydrates','fa-wheat-awn',f.carbs+'g',cp,'#f39c12');
  html+=bar('Fat','fa-droplet',f.fat+'g',fp,'#9b59b6');
  if(f.fiber)html+=bar('Fiber','fa-seedling',f.fiber+'g',fip,'#27ae60');
  html+='</div></div>';

  // AD 2
  html+='<div class="adc"><div class="adp">üì¢ Result Native Ad ‚Äî Paste Adstera Script Here</div></div>';

  // Vitamins
  html+='<div class="card"><div class="stitle"><i class="fas fa-pills"></i>Vitamins &amp; Minerals</div>';
  html+='<div class="vchips">'+f.vitamins.map(function(v){return'<span class="vc"><i class="fas fa-circle-check" style="font-size:10px"></i>'+v+'</span>';}).join('')+'</div></div>';

  // Ingredients
  html+='<div class="card"><div class="stitle"><i class="fas fa-flask-vial"></i>Key Compounds</div>';
  html+='<ul class="il">'+f.ingredients.map(function(ig){return'<li><i class="fas fa-leaf"></i>'+ig+'</li>';}).join('')+'</ul></div>';

  // Benefits
  html+='<div class="card"><div class="stitle"><i class="fas fa-heart-pulse"></i>Health Benefits</div><div class="bg_">';
  f.benefits.forEach(function(b,idx){
    html+='<div class="bi" style="animation-delay:'+idx*.08+'s"><div class="bico">'+b.i+'</div><div class="bit"><h4>'+b.t+'</h4><p>'+b.d+'</p></div></div>';
  });
  html+='</div></div>';

  // Side effects
  html+='<div class="card"><div class="stitle"><i class="fas fa-triangle-exclamation" style="color:#e74c3c"></i>Side Effects &amp; Warnings</div>';
  html+='<div class="acc"><div class="ach" onclick="sfx(\'tap\');togAcc(this)">';
  html+='<div class="ach-left"><i class="fas fa-circle-exclamation"></i>‚ö†Ô∏è View Warnings</div>';
  html+='<i class="fas fa-chevron-down" style="transition:transform .3s"></i></div>';
  html+='<div class="acb"><ul>'+f.side.map(function(s){return'<li>'+s+'</li>';}).join('')+'</ul></div></div></div>';

  // Diet goal
  html+='<div class="card"><div class="stitle"><i class="fas fa-bullseye"></i>Diet Goal Suggestion</div>';
  html+='<div class="gt">';
  html+='<button class="gtb on" onclick="sfx(\'tap\');setG(\'loss\',this)"><i class="fas fa-arrow-trend-down"></i> Weight Loss</button>';
  html+='<button class="gtb" onclick="sfx(\'tap\');setG(\'muscle\',this)"><i class="fas fa-dumbbell"></i> Muscle Gain</button>';
  html+='<button class="gtb" onclick="sfx(\'tap\');setG(\'gain\',this)"><i class="fas fa-arrow-trend-up"></i> Weight Gain</button>';
  html+='</div><p class="gc" id="gc">'+GOALS.loss[lang]+'</p></div>';

  // Share
  html+='<button class="shbtn ripple" onclick="sfx(\'click\');shareR()"><i class="fas fa-share-nodes"></i> Share Nutrition Result</button>';
  html+='<p style="font-size:11px;color:var(--muted);text-align:center;padding:8px 0 4px;display:flex;align-items:center;justify-content:center;gap:6px"><i class="fas fa-circle-info" style="color:var(--p)"></i> Values are approximate estimates for educational use only</p>';

  document.getElementById('res').innerHTML=html;
  setTimeout(function(){
    document.querySelectorAll('.bf[data-w]').forEach(function(b){b.style.width=b.getAttribute('data-w')+'%';});
  },200);
}

function bar(name,ico,val,pct,color){
  return '<div class="nb"><div class="nbl"><div class="nbl-left"><i class="fas '+ico+'" style="color:'+color+';font-size:11px"></i><span>'+name+'</span></div><span style="color:'+color+'">'+val+'</span></div>'+
    '<div class="bt"><div class="bf" style="width:0;background:'+color+'" data-w="'+pct+'"></div></div></div>';
}

function togAcc(h){
  var b=h.nextElementSibling,ico=h.querySelector('.fa-chevron-down');
  b.classList.toggle('on');
  if(ico)ico.style.transform=b.classList.contains('on')?'rotate(180deg)':'';
}

function setG(g,btn){
  curGoal=g;
  document.querySelectorAll('.gtb').forEach(function(b){b.classList.remove('on');});
  btn.classList.add('on');
  var el=document.getElementById('gc');
  if(el)el.textContent=GOALS[g][lang];
}

// SHARE
function shareR(){
  if(!food)return;
  var txt='ü•ó '+food.name+' Nutrition ('+food.serving+')\nüî• Calories: '+food.calories+' kcal\nüí™ Protein: '+food.protein+'g\nüçû Carbs: '+food.carbs+'g\nü•ë Fat: '+food.fat+'g\n\nScanned with NutriScan AI ‚Äî Educational estimates only';
  if(navigator.share){navigator.share({title:'NutriScan AI',text:txt}).catch(function(){});}
  else if(navigator.clipboard){navigator.clipboard.writeText(txt).then(function(){toast('üìã Copied!','fa-copy');});}
  else{toast('Share not available','fa-circle-xmark');}
}

// BMI
function calcBMI(){
  var w=parseFloat(document.getElementById('bw').value);
  var h=parseFloat(document.getElementById('bh').value)/100;
  if(!w||!h||w<=0||h<=0){sfx('error');toast('Please enter valid values','fa-circle-xmark');return;}
  var bmi=(w/(h*h)).toFixed(1);
  var res=document.getElementById('bmiRes');
  res.classList.remove('hidden');
  var cat,color,desc;
  if(bmi<18.5){cat='Underweight';color='#3498db';desc='Consider increasing calorie intake with nutrient-dense foods.';}
  else if(bmi<25){cat='Normal Weight ‚úÖ';color='#2ecc71';desc='Great! Maintain your healthy lifestyle.';}
  else if(bmi<30){cat='Overweight';color='#f39c12';desc='Consider a moderate calorie deficit and regular activity.';}
  else{cat='Obese';color='#e74c3c';desc='Please consult a healthcare professional.';}
  document.getElementById('bnum').textContent=bmi;
  document.getElementById('bnum').style.color=color;
  document.getElementById('bcat').textContent=cat;
  document.getElementById('bcat').style.color=color;
  document.getElementById('bdesc').textContent=desc;
  sfx('success');
  res.scrollIntoView({behavior:'smooth',block:'nearest'});
}

// PROTEIN
function setGoalP(){
  var g=parseInt(document.getElementById('pgi').value);
  if(!g||g<10){sfx('error');toast('Enter valid goal','fa-circle-xmark');return;}
  pdata.goal=g;saveP();renderP();toast('‚úÖ Goal updated!','fa-check-circle');
}
function addP(){
  var a=parseFloat(document.getElementById('padd').value);
  if(!a||a<=0){sfx('error');toast('Enter valid amount','fa-circle-xmark');return;}
  pdata.consumed+=a;
  if(!pdata.log)pdata.log=[];
  pdata.log.unshift({s:'Manual entry',ico:'fa-plus-circle',a:a,t:new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})});
  document.getElementById('padd').value='';
  saveP();renderP();sfx('success');
}
function qadd(a,name,ico){
  pdata.consumed+=a;
  if(!pdata.log)pdata.log=[];
  pdata.log.unshift({s:name,ico:ico||'fa-utensils',a:a,t:new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})});
  saveP();renderP();toast('+'+a+'g added! üí™','fa-check-circle');
}
function resetP(){pdata.consumed=0;pdata.log=[];saveP();renderP();toast('Reset for new day! üåÖ','fa-rotate-left');}
function saveP(){localStorage.setItem('pd',JSON.stringify(pdata));}
function renderP(){
  var pct=Math.min(100,(pdata.consumed/pdata.goal)*100);
  var deg=(pct/100)*360;
  var c=document.getElementById('pcirc');
  if(c)c.style.background='conic-gradient(var(--p) 0deg, var(--p) '+deg+'deg, var(--bg) '+deg+'deg)';
  var pc=document.getElementById('pcons');if(pc)pc.textContent=Math.round(pdata.consumed);
  var pg=document.getElementById('pgoald');if(pg)pg.textContent=pdata.goal;
  var pi=document.getElementById('pgi');if(pi)pi.value=pdata.goal;
  var log=document.getElementById('plog');
  if(!log)return;
  if(!pdata.log||!pdata.log.length){log.innerHTML='<li style="color:var(--muted);font-size:13px">No entries yet</li>';return;}
  log.innerHTML=pdata.log.slice(0,8).map(function(e){
    return'<li><div class="pli-left"><div class="pli-ico"><i class="fas '+(e.ico||'fa-utensils')+'"></i></div><span>'+e.s+'</span></div><span style="display:flex;align-items:center;gap:8px"><span class="pt">'+e.t+'</span><strong style="color:var(--pd)">+'+e.a+'g</strong></span></li>';
  }).join('');
}

// HISTORY
function renderH(){
  var list=document.getElementById('hlist');if(!list)return;
  if(!history_.length){list.innerHTML='<div class="hem"><i class="fas fa-bowl-food"></i><p style="font-size:14px;font-weight:600;color:var(--txt)">No scan history yet</p><p style="font-size:13px;margin-top:4px">Start scanning food to see history here</p></div>';return;}
  list.innerHTML=history_.map(function(item,i){
    return'<div class="hi" onclick="sfx(\'tap\');reopenH('+i+')"><div class="hie">'+item.emoji+'</div><div class="hii"><h4>'+item.name+'</h4><p><i class="fas fa-clock" style="font-size:10px;color:var(--p)"></i> '+new Date(item.ts).toLocaleDateString()+'</p></div><span class="hic"><i class="fas fa-fire" style="font-size:11px"></i> '+item.calories+' kcal</span></div>';
  }).join('');
}
function reopenH(i){renderResult(history_[i],history_[i].img||null);go('result');}
function clearH(){if(!confirm('Clear all history?'))return;history_=[];localStorage.setItem('sh','[]');renderH();toast('History cleared','fa-trash');}

// RECENT
function renderRecent(){
  var el=document.getElementById('hRecent');if(!el)return;
  if(!history_.length){el.innerHTML='<p style="font-size:13px;color:var(--muted);text-align:center;padding:12px 0">No scans yet. Start scanning!</p>';return;}
  el.innerHTML=history_.slice(0,3).map(function(item,i){
    return'<div class="hi" onclick="sfx(\'tap\');reopenH('+i+')" style="box-shadow:none;padding:8px 0;border-bottom:1px solid rgba(46,204,113,.08)"><div class="hie" style="font-size:22px">'+item.emoji+'</div><div class="hii"><h4 style="font-size:13px">'+item.name+'</h4><p>'+new Date(item.ts).toLocaleDateString()+'</p></div><span class="hic">'+item.calories+' kcal</span></div>';
  }).join('');
}

// TOAST
function toast(msg,ico){
  var t=document.getElementById('toast');
  var ti=document.getElementById('toastIco');
  var tt=document.getElementById('toastTxt');
  if(ti)ti.className='fas '+(ico||'fa-check-circle');
  if(tt)tt.textContent=msg;
  t.classList.add('on');
  setTimeout(function(){t.classList.remove('on');},2500);
}

// INTERSTITIAL
function showIad(){document.getElementById('iad').classList.add('on');}
function closeIad(){sfx('tap');document.getElementById('iad').classList.remove('on');}

// EXIT POPUP
var warned=false;
window.addEventListener('popstate',function(){
  if(!warned){warned=true;history.pushState(null,null,location.pathname);document.getElementById('epo').classList.add('on');}
});
history.pushState(null,null,location.pathname);
function closeExit(){document.getElementById('epo').classList.remove('on');warned=false;}

// RESTORE PREFS
if(localStorage.getItem('dk')==='1')toggleDark();
if(localStorage.getItem('mu')==='0'){musicOn=false;document.getElementById('musicFab').classList.add('muted');}
</script>
</body>
</html>
