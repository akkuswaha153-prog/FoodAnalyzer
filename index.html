<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NutriScan - AI Food Scanner (Claude Vision)</title>

    <!-- ============================================================
         ‚úÖ GOOGLE ADSENSE / ADMOB INTEGRATION
         ============================================================ -->
   ca-app-pub-9680042092367503/8956491013
 <script async
      data-adbreak-test="on"
      data-admob-interstitial-slot="ca-app-pub-XXXXXXXXXXXXXXXXX/XXXXXXXXXX"
      data-admob-rewarded-slot="ca-app-pub-XXXXXXXXXXXXXXXXX/XXXXXXXXXX"
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXXX"
      crossorigin="anonymous">
    </script>
    <script>
      window.adsbygoogle = window.adsbygoogle || [];
      const adBreak = adConfig = function(o) { adsbygoogle.push(o); }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800&family=Space+Mono:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-green: #00D084;
            --primary-orange: #FF6B35;
            --primary-purple: #7B2CBF;
            --primary-blue: #4CC9F0;
            --dark-bg: #1A1A2E;
            --card-bg: #252540;
            --text-primary: #FFFFFF;
            --text-secondary: #B8B8D1;
            --success: #06FFA5;
            --warning: #FFD60A;
            --danger: #FF006E;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(135deg, #1A1A2E 0%, #16213E 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(0, 208, 132, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 107, 53, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(76, 201, 240, 0.1) 0%, transparent 50%);
            animation: float 20s ease-in-out infinite;
            z-index: 0;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-20px) scale(1.05); }
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .app-header {
            text-align: center;
            margin-bottom: 30px;
            padding-top: 20px;
        }

        .app-logo {
            font-size: 3rem;
            margin-bottom: 10px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .app-title {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-green), var(--primary-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 5px;
        }

        .app-subtitle {
            font-family: 'Space Mono', monospace;
            color: var(--text-secondary);
            font-size: 0.9rem;
            letter-spacing: 2px;
        }

        .scan-section {
            margin-bottom: 30px;
        }

        .scan-button {
            width: 100%;
            padding: 30px;
            background: linear-gradient(135deg, var(--primary-green), var(--primary-blue));
            border: none;
            border-radius: 25px;
            font-family: 'Outfit', sans-serif;
            font-size: 1.5rem;
            font-weight: 800;
            color: white;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 208, 132, 0.3);
            transition: all 0.3s ease;
        }

        .scan-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px rgba(0, 208, 132, 0.5);
        }

        .scan-button:active {
            transform: scale(0.98);
        }

        .scan-button::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transform: rotate(45deg);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .button-icon {
            font-size: 2rem;
            margin-right: 10px;
        }

        .divider {
            display: flex;
            align-items: center;
            margin: 20px 0;
            color: var(--text-secondary);
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--text-secondary), transparent);
        }

        .divider span {
            padding: 0 15px;
            font-family: 'Space Mono', monospace;
            font-size: 0.8rem;
        }

        .upload-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .upload-button {
            padding: 15px 30px;
            background: var(--card-bg);
            border: 2px dashed var(--primary-purple);
            border-radius: 15px;
            color: var(--text-primary);
            font-family: 'Outfit', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-button:hover {
            background: var(--primary-purple);
            border-color: var(--primary-purple);
        }

        #fileInput, #cameraInput {
            display: none;
        }

        .preview-section {
            display: none;
            margin-bottom: 30px;
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .preview-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .preview-image {
            width: 100%;
            border-radius: 15px;
            margin-bottom: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
        }

        .analyze-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary-orange), var(--danger));
            border: none;
            border-radius: 15px;
            color: white;
            font-family: 'Outfit', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .analyze-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.4);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            margin: 0 auto 20px;
            border: 4px solid var(--card-bg);
            border-top: 4px solid var(--primary-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.2rem;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .results-section {
            display: none;
            animation: slideUp 0.5s ease;
        }

        .result-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .result-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-green), var(--primary-blue), var(--primary-purple));
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-icon {
            font-size: 1.8rem;
        }

        .food-name {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary-green);
            margin-bottom: 10px;
        }

        .food-category {
            display: inline-block;
            padding: 8px 20px;
            background: linear-gradient(135deg, var(--primary-purple), var(--primary-blue));
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .food-description {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .nutrition-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .nutrition-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 15px;
            border-left: 4px solid var(--primary-green);
            transition: all 0.3s ease;
        }

        .nutrition-item:hover {
            transform: translateX(5px);
            background: rgba(255, 255, 255, 0.1);
        }

        .nutrition-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
            font-family: 'Space Mono', monospace;
        }

        .nutrition-value {
            font-size: 1.3rem;
            font-weight: 800;
            color: var(--primary-green);
        }

        .benefits-list {
            margin-top: 15px;
        }

        .benefit-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px;
            background: rgba(6, 255, 165, 0.1);
            border-radius: 12px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .benefit-item:hover {
            background: rgba(6, 255, 165, 0.2);
            transform: translateX(5px);
        }

        .benefit-icon {
            font-size: 1.3rem;
            margin-top: 2px;
        }

        .benefit-text {
            flex: 1;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .risk-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px;
            background: rgba(255, 107, 53, 0.1);
            border-radius: 12px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .risk-item:hover {
            background: rgba(255, 107, 53, 0.2);
            transform: translateX(5px);
        }

        .recommendation-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .recommendation-box {
            padding: 15px;
            border-radius: 15px;
            text-align: center;
        }

        .good-for {
            background: rgba(6, 255, 165, 0.15);
            border: 2px solid var(--success);
        }

        .avoid-for {
            background: rgba(255, 0, 110, 0.15);
            border: 2px solid var(--danger);
        }

        .recommendation-title {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .recommendation-list {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .disclaimer {
            background: rgba(255, 214, 10, 0.15);
            border: 2px solid var(--warning);
            border-radius: 15px;
            padding: 15px;
            margin-top: 20px;
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .disclaimer-icon {
            font-size: 1.5rem;
        }

        .disclaimer-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .action-button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 15px;
            font-family: 'Outfit', sans-serif;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .scan-another {
            background: linear-gradient(135deg, var(--primary-green), var(--primary-blue));
            color: white;
        }

        .share-button {
            background: var(--card-bg);
            color: var(--text-primary);
            border: 2px solid var(--primary-purple);
        }

        .action-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .dark-mode-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: var(--card-bg);
            border: 2px solid var(--primary-purple);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .dark-mode-toggle:hover {
            transform: rotate(180deg);
            background: var(--primary-purple);
        }

        body.light-mode {
            background: linear-gradient(135deg, #F0F4FF 0%, #E8F5E9 100%);
            color: #1A1A2E;
        }

        body.light-mode::before {
            background: 
                radial-gradient(circle at 20% 80%, rgba(0, 208, 132, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 107, 53, 0.15) 0%, transparent 50%);
        }

        body.light-mode .result-card,
        body.light-mode .preview-card {
            background: white;
            color: #1A1A2E;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        body.light-mode .upload-button {
            background: white;
            color: #1A1A2E;
        }

        body.light-mode .food-description,
        body.light-mode .benefit-text,
        body.light-mode .nutrition-label,
        body.light-mode .disclaimer-text,
        body.light-mode .recommendation-list {
            color: #5A5A7A;
        }

        body.light-mode .nutrition-item {
            background: rgba(0, 0, 0, 0.03);
        }

        body.light-mode .dark-mode-toggle {
            background: white;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        @media (max-width: 480px) {
            .app-title {
                font-size: 2rem;
            }
            
            .scan-button {
                padding: 25px;
                font-size: 1.3rem;
            }

            .nutrition-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dark-mode-toggle" onclick="toggleDarkMode()">
        <span id="modeIcon">üåô</span>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="app-header">
            <div class="app-logo">ü•ó</div>
            <h1 class="app-title">NutriScan</h1>
            <p class="app-subtitle">FOOD ‚Ä¢ NUTRITION ‚Ä¢ ANALYSIS</p>
        </div>

        <!-- Main Scan Section -->
        <div id="scanSection" class="scan-section">
            <!-- Camera Button (Primary) -->
            <button class="scan-button" onclick="openCamera()">
                <span class="button-icon">üì∏</span>
                Camera Se Scan Karo
            </button>

            <!-- Gallery Button (Secondary, below camera) -->
            <button class="upload-button" onclick="openGallery()" style="
                width: 100%;
                margin-top: 15px;
                padding: 18px 30px;
                font-size: 1.1rem;
            ">
                <span>üìÅ</span> Gallery Se Photo Select Karo
            </button>

            <input type="file" id="fileInput" accept="image/*" onchange="handleFileSelect(event)">
            <input type="file" id="cameraInput" accept="image/*" capture="environment" onchange="handleFileSelect(event)">

            ca-app-pub-9680042092367503/8386016500
            <div style="margin-top: 18px; text-align: center; min-height: 100px;">
                <ins class="adsbygoogle"
                     style="display: block; margin: 0 auto;"
                     data-ad-format="auto"
                     data-full-width-responsive="true"
                     data-ad-client="ca-pub-XXXXXXXXXXXXXXXXX"
                     data-ad-slot="XXXXXXXXXX">
                </ins>
                <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>

            <div class="divider" style="margin-top: 25px;">
                <span></span>
            </div>
        </div>

        <!-- Preview Section -->
        <div id="previewSection" class="preview-section">
            <div class="preview-card">
                <img id="previewImage" class="preview-image" alt="Food Preview">
                <button class="analyze-button" onclick="analyzeImage()">
                    <span>üîç</span> AI Se Analyze Karo
                </button>
            </div>
        </div>

        <!-- Loading Section -->
        <div id="loadingSection" class="loading">
            <div class="loading-spinner"></div>
            <p class="loading-text">Claude AI analyzing... ü§ñ</p>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="results-section">
            <div class="result-card">
                <h2 class="card-title">
                    <span class="card-icon">üçé</span>
                    Food Information
                </h2>
                <h3 class="food-name" id="foodName">Loading...</h3>
                <span class="food-category" id="foodCategory">...</span>
                <p class="food-description" id="foodDescription">...</p>
            </div>

            <div class="result-card">
                <h2 class="card-title">
                    <span class="card-icon">üìä</span>
                    Nutrition Facts (per 100g)
                </h2>
                <div class="nutrition-grid" id="nutritionGrid"></div>
            </div>

            <div class="result-card">
                <h2 class="card-title">
                    <span class="card-icon">üí™</span>
                    Health Benefits (Fayde)
                </h2>
                <div class="benefits-list" id="benefitsList"></div>
            </div>

            <div class="result-card">
                <h2 class="card-title">
                    <span class="card-icon">‚ö†Ô∏è</span>
                    Health Risks (Nuksan)
                </h2>
                <div class="benefits-list" id="risksList"></div>
            </div>

            <div class="result-card">
                <h2 class="card-title">
                    <span class="card-icon">üë•</span>
                    Who Should Eat / Avoid
                </h2>
                <div class="recommendation-grid">
                    <div class="recommendation-box good-for">
                        <div class="recommendation-title">‚úÖ Good For</div>
                        <div class="recommendation-list" id="goodForList"></div>
                    </div>
                    <div class="recommendation-box avoid-for">
                        <div class="recommendation-title">‚ùå Avoid For</div>
                        <div class="recommendation-list" id="avoidForList"></div>
                    </div>
                </div>
            </div>

            <div class="disclaimer">
                <span class="disclaimer-icon">‚öïÔ∏è</span>
                <div class="disclaimer-text">
                    <strong>Important Disclaimer:</strong> This information is for educational and awareness purposes only. Nutrition values shown are approximate estimates, not exact measurements. This is NOT medical advice and should not be used for diagnosis or treatment. For specific health conditions, dietary needs, or medical concerns, please consult a qualified healthcare professional or registered dietitian.
                </div>
            </div>

            <div class="action-buttons">
                <button class="action-button scan-another" onclick="scanAnother()">
                    üì∏ Scan Another
                </button>
                <button class="action-button share-button" onclick="shareResults()">
                    üì§ Share
                </button>
            </div>
        </div>
    </div>

    <script>
        // ============================================================
        // üîê ANTHROPIC API CONFIGURATION
        // ============================================================
        // ‚ö†Ô∏è IMPORTANT: APNI NEW API KEY YAHAN LAGAO (line 763)
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // 1. Console.anthropic.com pe jaao
        // 2. Settings ‚Üí API Keys
        // 3. "Create Key" click karo
        // 4. Neeche quotes ke beech paste karo:
        
        const ANTHROPIC_API_KEY = 'YOUR_NEW_API_KEY_HERE';
        
        // Example: const ANTHROPIC_API_KEY = 'sk-ant-api03-xxxxxx...';
        // ‚ö†Ô∏è Is file ko kabhi public/github pe upload mat karo!
        // ============================================================
        
        // Verify API key is set
        if (!ANTHROPIC_API_KEY || ANTHROPIC_API_KEY === 'YOUR_NEW_API_KEY_HERE') {
            console.warn('‚ö†Ô∏è API key not configured. Please add your new Anthropic API key above (line 763).');
        }
        
        // Sound effects
        const sounds = {
            click: new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZizcIGGe76+efTRALUKrm8LJeGAU7k9nyz3wuBSl+zPLaizsIHGS56eaZSg0MUqvl8LFeGAU7lNryz34wBSh8y/LajDsIF2S76+icTBAMUavl8LJeGAU7ldryz38wBSh8y/LajDsIF2O76+idTBALUqzl8LJeGAU7lNryz38wBSh8y/LajDsIF2O76+idTBALUqzl8LJeGAU6lNvyz3'),
            success: new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA='),
            scan: new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=')
        };

        let currentImage = null;
        let currentImageBase64 = null;

        // Play sound function
        function playSound(soundName) {
            if (sounds[soundName]) {
                sounds[soundName].currentTime = 0;
                sounds[soundName].play().catch(e => console.log('Sound play failed:', e));
            }
        }

        // ============================================================
        // üì∏ CAMERA & FILE FUNCTIONS
        // ============================================================
        
        function openCamera() {
            playSound('click');
            document.getElementById('cameraInput').click();
        }

        function openGallery() {
            playSound('click');
            document.getElementById('fileInput').click();
        }

        function handleFileSelect(event) {
            console.log('üì∏ File select triggered');
            const file = event.target.files[0];
            console.log('üìÅ File:', file);
            
            if (file && file.type.startsWith('image/')) {
                console.log('‚úÖ Valid image file detected');
                playSound('scan'); // Sound effect on photo selection
                
                currentImage = file;
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    console.log('üñºÔ∏è Image loaded, showing preview...');
                    currentImageBase64 = e.target.result.split(',')[1];
                    document.getElementById('previewImage').src = e.target.result;
                    
                    document.getElementById('scanSection').style.display = 'none';
                    document.getElementById('previewSection').style.display = 'block';
                    
                    console.log('‚úÖ Preview section displayed');
                    
                    setTimeout(() => {
                        document.getElementById('previewSection').scrollIntoView({ behavior: 'smooth' });
                    }, 100);
                };
                
                reader.readAsDataURL(file);
            } else {
                console.log('‚ùå Invalid file type or no file selected');
            }
        }

        // ============================================================
        // ü§ñ CLAUDE VISION API INTEGRATION
        // ============================================================
        
        async function analyzeWithClaudeVision(base64Image) {
            const apiUrl = 'https://api.anthropic.com/v1/messages';
            
            // Determine image type from currentImage
            const imageType = currentImage.type || 'image/jpeg';
            
            const requestBody = {
                model: 'claude-sonnet-4-20250514',
                max_tokens: 2048,
                messages: [{
                    role: 'user',
                    content: [
                        {
                            type: 'image',
                            source: {
                                type: 'base64',
                                media_type: imageType,
                                data: base64Image
                            }
                        },
                        {
                            type: 'text',
                            text: `You are a professional Food & Nutrition Analysis AI designed ONLY for educational and awareness purposes, not for medical diagnosis or treatment.

Your task: Analyze the food item from the image and generate a SAFE, ACCURATE, and RESPONSIBLE nutrition report.

--------------------
IMPORTANT SAFETY RULES (MANDATORY)
--------------------
1. NEVER provide medical advice.
2. NEVER say "must eat", "must avoid", "cures", or "treats disease".
3. NEVER claim exact nutrition values. All values must be clearly marked as APPROXIMATE ESTIMATES.
4. Use soft, cautious language such as:
   - "may be beneficial"
   - "may require caution"
   - "generally considered"
5. If the image is unclear, say: "The image is not clear enough for accurate identification."
6. Do NOT encourage dieting, body shaping, or weight loss.
7. Content must be safe for teens (13+).

--------------------
FOOD IDENTIFICATION RULE
--------------------
- Identify the food conservatively.
- If unsure between similar foods, say: "This appears to be most likely ___, but may vary."

--------------------
OUTPUT FORMAT (Return JSON ONLY, no markdown)
--------------------
{
  "foodName": "Identified food name in English (Hindi name) - with confidence level if needed",
  "category": "Vegetarian/Non-Vegetarian ‚Ä¢ Raw/Cooked ‚Ä¢ Type",
  "description": "Simple explanation in Hinglish. What this food is and how it's commonly used. 2-3 sentences.",
  "nutrition": {
    "Calories": "approx XX kcal (estimate)",
    "Protein": "approx X g (estimate)",
    "Carbs": "approx X g (estimate)",
    "Fiber": "approx X g (estimate)",
    "Fat": "approx X g (estimate)",
    "Vitamin C": "approx X mg (estimate)",
    "Iron": "approx X mg (estimate)",
    "Calcium": "approx X mg (estimate)"
  },
  "benefits": [
    "üíö General benefit 1 in Hinglish - use 'may be beneficial' language",
    "üí™ General benefit 2 - no disease claims",
    "üß† General benefit 3 - educational only",
    "‚ù§Ô∏è General benefit 4 - no medical claims",
    "‚ú® General benefit 5 - simple health awareness"
  ],
  "risks": [
    "‚ö†Ô∏è 'May need caution' language only - no strict avoid commands",
    "üîî Simple awareness points in Hinglish",
    "üí° Educational cautions, not medical warnings"
  ],
  "goodFor": [
    "General wellness seekers",
    "People seeking variety",
    "Balanced diet followers"
  ],
  "avoidFor": [
    "People with specific allergies MAY need caution",
    "Those with certain conditions MAY want to consult professionals"
  ]
}

CRITICAL: 
- Use "approx" and "estimate" in ALL nutrition values
- Use "may", "might", "generally" in benefits/risks
- NO absolute statements
- Include disclaimer mindset in tone

Make sure nutrition values are reasonable approximations for this specific food. Be helpful but ALWAYS safe and responsible.`
                        }
                    ]
                }]
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': ANTHROPIC_API_KEY,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API Error: ${errorData.error?.message || response.statusText}`);
                }

                const data = await response.json();
                console.log('üì• API Response:', data);
                
                const aiResponse = data.content[0].text;
                console.log('üìù AI Response text:', aiResponse);
                
                // Clean up response - remove markdown code blocks if present
                let cleanResponse = aiResponse.trim();
                if (cleanResponse.startsWith('```json')) {
                    cleanResponse = cleanResponse.replace(/```json\n?/g, '').replace(/```\n?/g, '');
                } else if (cleanResponse.startsWith('```')) {
                    cleanResponse = cleanResponse.replace(/```\n?/g, '');
                }
                
                // Parse JSON response
                const foodData = JSON.parse(cleanResponse);
                console.log('‚úÖ Parsed food data:', foodData);
                return foodData;
                
            } catch (error) {
                console.error('‚ùå Claude Vision API Error:', error);
                console.error('Error details:', error.message);
                
                // Provide more helpful error message
                if (error.message.includes('JSON')) {
                    throw new Error('AI response format galat tha. Phir se try karo.');
                } else if (error.message.includes('API Error')) {
                    throw new Error(error.message);
                } else {
                    throw new Error('Internet connection check karo aur phir try karo.');
                }
            }
        }

        // ============================================================
        // üìä ANALYZE IMAGE FUNCTION
        // ============================================================
        
        function analyzeImage() {
            playSound('click'); // Sound on analyze button click
            
            document.getElementById('previewSection').style.display = 'none';
            
            // Reset loading section to original state
            document.getElementById('loadingSection').innerHTML = `
                <div class="loading-spinner"></div>
                <p class="loading-text">Claude AI analyzing... ü§ñ</p>
            `;
            document.getElementById('loadingSection').style.display = 'block';

            ca-app-pub-9680042092367503/8956491013
            adBreak({
                type: 'next',
                name: 'before-analysis',
                beforeAd: function() {
                    document.getElementById('loadingSection').querySelector('.loading-text').textContent = '‚è≥ Ek second...';
                },
                afterAd: function() {
                    document.getElementById('loadingSection').querySelector('.loading-text').textContent = 'Claude AI analyzing... ü§ñ';
                    runAIAnalysis();
                }
            });

            setTimeout(function() {
                if (document.getElementById('loadingSection').style.display === 'block' &&
                    document.getElementById('resultsSection').style.display !== 'block') {
                    runAIAnalysis();
                }
            }, 3500);
        }

        async function runAIAnalysis() {
            try {
                console.log('ü§ñ Starting AI analysis...');
                console.log('üì∑ Image base64 length:', currentImageBase64?.length);
                
                const foodData = await analyzeWithClaudeVision(currentImageBase64);
                console.log('‚úÖ Analysis complete:', foodData);
                
                playSound('success'); // Success sound
                displayResults(foodData);

                document.getElementById('loadingSection').style.display = 'none';
                document.getElementById('resultsSection').style.display = 'block';
                document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });

            } catch (error) {
                console.error('‚ùå Analysis error:', error);
                
                // Show error message
                document.getElementById('loadingSection').innerHTML = `
                    <div style="text-align: center; padding: 30px;">
                        <div style="font-size: 3rem; margin-bottom: 15px;">‚ùå</div>
                        <h3 style="color: var(--danger); margin-bottom: 10px;">Oops! Error Aaya</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 15px; line-height: 1.6;">
                            ${error.message || 'Claude AI se connect nahi ho paya. Internet check karo aur phir try karo.'}
                        </p>
                        <button onclick="goToScanPage()" style="
                            padding: 12px 24px; background: var(--primary-green);
                            border: none; border-radius: 10px; color: white;
                            font-weight: 700; cursor: pointer; font-family: 'Outfit', sans-serif;
                        ">üîÑ Phir Se Try Karo</button>
                    </div>
                `;
            }
        }

        // ============================================================
        // üìä DISPLAY RESULTS
        // ============================================================
        
        function displayResults(food) {
            document.getElementById('foodName').textContent = food.foodName || 'Unknown Food';
            document.getElementById('foodCategory').innerHTML = food.category || '‚ùì Unknown';
            document.getElementById('foodDescription').textContent = food.description || 'No description available.';
            
            // Nutrition grid
            const nutritionGrid = document.getElementById('nutritionGrid');
            nutritionGrid.innerHTML = '';
            if (food.nutrition) {
                Object.entries(food.nutrition).forEach(([key, value]) => {
                    nutritionGrid.innerHTML += `
                        <div class="nutrition-item">
                            <div class="nutrition-label">${key}</div>
                            <div class="nutrition-value">${value}</div>
                        </div>
                    `;
                });
            }
            
            // Benefits
            const benefitsList = document.getElementById('benefitsList');
            benefitsList.innerHTML = '';
            if (food.benefits) {
                food.benefits.forEach(benefit => {
                    benefitsList.innerHTML += `
                        <div class="benefit-item">
                            <span class="benefit-icon">‚úÖ</span>
                            <span class="benefit-text">${benefit}</span>
                        </div>
                    `;
                });
            }
            
            // Risks
            const risksList = document.getElementById('risksList');
            risksList.innerHTML = '';
            if (food.risks) {
                food.risks.forEach(risk => {
                    risksList.innerHTML += `
                        <div class="risk-item">
                            <span class="benefit-icon">‚ö†Ô∏è</span>
                            <span class="benefit-text">${risk}</span>
                        </div>
                    `;
                });
            }
            
            // Recommendations
            document.getElementById('goodForList').innerHTML = food.goodFor ? 
                food.goodFor.map(item => `<div>‚Ä¢ ${item}</div>`).join('') : '';
            
            document.getElementById('avoidForList').innerHTML = food.avoidFor ? 
                food.avoidFor.map(item => `<div>‚Ä¢ ${item}</div>`).join('') : '';
        }

        // ============================================================
        // üîÑ ACTION FUNCTIONS
        // ============================================================
        
        function scanAnother() {
            const rewardBanner = document.createElement('div');
            rewardBanner.id = 'rewardBanner';
            rewardBanner.style.cssText = `
                position:fixed; top:0; left:0; width:100%; height:100%;
                background:rgba(26,26,46,0.92); z-index:9999;
                display:flex; flex-direction:column;
                align-items:center; justify-content:center; gap:16px;
                padding:30px; text-align:center;
            `;
            rewardBanner.innerHTML = `
                <div style="font-size:2.8rem;">üéÅ</div>
                <h2 style="font-size:1.4rem; font-weight:800; color:#fff; margin:0;">
                    Bonus Nutrition Tip Chahiye?
                </h2>
                <p style="color:#B8B8D1; font-size:0.95rem; margin:0; max-width:280px; line-height:1.5;">
                    Ek short ad dekho aur apne next scan ke saath
                    <strong style="color:#FFD60A;">extra detail</strong> milegi!
                </p>
                <button id="watchAdBtn" style="
                    margin-top:8px; padding:14px 32px;
                    background:linear-gradient(135deg,#FFD60A,#FF6B35);
                    border:none; border-radius:14px; color:#1A1A2E;
                    font-family:'Outfit',sans-serif; font-size:1.1rem;
                    font-weight:800; cursor:pointer;
                ">üì∫ Watch Ad & Get Bonus</button>
                <button id="skipAdBtn" style="
                    margin-top:4px; padding:10px 24px;
                    background:transparent; border:2px solid #B8B8D1;
                    border-radius:10px; color:#B8B8D1;
                    font-family:'Outfit',sans-serif; font-size:0.85rem;
                    font-weight:600; cursor:pointer;
                ">Skip</button>
            `;
            document.body.appendChild(rewardBanner);

            let showRewardedAdFn = null;
            let adWasTriggered = false;

            document.getElementById('skipAdBtn').addEventListener('click', function() {
                rewardBanner.remove();
                goToScanPage();
            });

            document.getElementById('watchAdBtn').addEventListener('click', function() {
                if (showRewardedAdFn) {
                    adWasTriggered = true;
                    showRewardedAdFn();
                } else {
                    rewardBanner.remove();
                    goToScanPage();
                }
            });

            adBreak({
                type: 'reward',
                name: 'scan-again-reward',
                beforeReward: function(showAdFn) {
                    showRewardedAdFn = showAdFn;
                },
                beforeAd: function() {
                    rewardBanner.style.display = 'none';
                },
                adDismissed: function() {
                    rewardBanner.remove();
                    goToScanPage();
                },
                adViewed: function() {
                    rewardBanner.remove();
                    alert('üéâ Bonus! Aapko next scan me extra detail milegi. Thanks for watching!');
                    goToScanPage();
                },
                afterAd: function() {
                    if (document.getElementById('rewardBanner')) {
                        rewardBanner.remove();
                        goToScanPage();
                    }
                }
            });

            setTimeout(function() {
                if (document.getElementById('rewardBanner') && !adWasTriggered) {
                    rewardBanner.remove();
                    goToScanPage();
                }
            }, 2500);
        }

        function goToScanPage() {
            currentImage = null;
            currentImageBase64 = null;
            document.getElementById('fileInput').value = '';
            document.getElementById('cameraInput').value = '';
            
            document.getElementById('scanSection').style.display = 'block';
            document.getElementById('previewSection').style.display = 'none';
            document.getElementById('loadingSection').style.display = 'none';
            document.getElementById('resultsSection').style.display = 'none';
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function shareResults() {
            const foodName = document.getElementById('foodName').textContent;
            const shareText = `ü•ó NutriScan AI Results:\n\nFood: ${foodName}\n\nPowered by Claude Vision AI ü§ñ\n#NutriScan #HealthyEating #Nutrition`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'NutriScan Results',
                    text: shareText
                }).catch(err => console.log('Share cancelled'));
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('Results copied to clipboard! üìã');
                });
            }
        }

        function toggleDarkMode() {
            const body = document.body;
            const modeIcon = document.getElementById('modeIcon');
            
            body.classList.toggle('light-mode');
            modeIcon.textContent = body.classList.contains('light-mode') ? '‚òÄÔ∏è' : 'üåô';
        }

        // ============================================================
        // üé¨ INITIALIZATION
        // ============================================================
        
        window.addEventListener('load', () => {
            adConfig({ sound: 'off' });

            document.querySelector('.container').style.opacity = '0';
            document.querySelector('.container').style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                document.querySelector('.container').style.transition = 'all 0.8s ease';
                document.querySelector('.container').style.opacity = '1';
                document.querySelector('.container').style.transform = 'translateY(0)';
            }, 100);
        });
    </script>
</body>
</html>
